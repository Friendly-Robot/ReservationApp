e90dd1de813b604c589f5792dfb38233
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var EmitterSubscription = require('EmitterSubscription');

var EventSubscriptionVendor = require('EventSubscriptionVendor');

var invariant = require('invariant');

var EventEmitter = function () {
  function EventEmitter(subscriber) {
    (0, _classCallCheck2.default)(this, EventEmitter);
    this._subscriber = subscriber || new EventSubscriptionVendor();
  }

  (0, _createClass2.default)(EventEmitter, [{
    key: "addListener",
    value: function addListener(eventType, listener, context) {
      return this._subscriber.addSubscription(eventType, new EmitterSubscription(this, this._subscriber, listener, context));
    }
  }, {
    key: "once",
    value: function once(eventType, listener, context) {
      var _this = this;

      return this.addListener(eventType, function () {
        _this.removeCurrentListener();

        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
          args[_key] = arguments[_key];
        }

        listener.apply(context, args);
      });
    }
  }, {
    key: "removeAllListeners",
    value: function removeAllListeners(eventType) {
      this._subscriber.removeAllSubscriptions(eventType);
    }
  }, {
    key: "removeCurrentListener",
    value: function removeCurrentListener() {
      invariant(!!this._currentSubscription, 'Not in an emitting cycle; there is no current subscription');
      this.removeSubscription(this._currentSubscription);
    }
  }, {
    key: "removeSubscription",
    value: function removeSubscription(subscription) {
      invariant(subscription.emitter === this, 'Subscription does not belong to this emitter.');

      this._subscriber.removeSubscription(subscription);
    }
  }, {
    key: "listeners",
    value: function listeners(eventType) {
      var subscriptions = this._subscriber.getSubscriptionsForType(eventType);

      return subscriptions ? subscriptions.map(function (subscription) {
        return subscription.listener;
      }) : [];
    }
  }, {
    key: "emit",
    value: function emit(eventType) {
      var subscriptions = this._subscriber.getSubscriptionsForType(eventType);

      if (subscriptions) {
        for (var i = 0, l = subscriptions.length; i < l; i++) {
          var subscription = subscriptions[i];

          if (subscription && subscription.listener) {
            this._currentSubscription = subscription;
            subscription.listener.apply(subscription.context, Array.prototype.slice.call(arguments, 1));
          }
        }

        this._currentSubscription = null;
      }
    }
  }, {
    key: "removeListener",
    value: function removeListener(eventType, listener) {
      var subscriptions = this._subscriber.getSubscriptionsForType(eventType);

      if (subscriptions) {
        for (var i = 0, l = subscriptions.length; i < l; i++) {
          var subscription = subscriptions[i];

          if (subscription && subscription.listener === listener) {
            subscription.remove();
          }
        }
      }
    }
  }]);
  return EventEmitter;
}();

module.exports = EventEmitter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkV2ZW50RW1pdHRlci5qcyJdLCJuYW1lcyI6WyJFbWl0dGVyU3Vic2NyaXB0aW9uIiwicmVxdWlyZSIsIkV2ZW50U3Vic2NyaXB0aW9uVmVuZG9yIiwiaW52YXJpYW50IiwiRXZlbnRFbWl0dGVyIiwic3Vic2NyaWJlciIsIl9zdWJzY3JpYmVyIiwiZXZlbnRUeXBlIiwibGlzdGVuZXIiLCJjb250ZXh0IiwiYWRkU3Vic2NyaXB0aW9uIiwiYWRkTGlzdGVuZXIiLCJyZW1vdmVDdXJyZW50TGlzdGVuZXIiLCJhcmdzIiwiYXBwbHkiLCJyZW1vdmVBbGxTdWJzY3JpcHRpb25zIiwiX2N1cnJlbnRTdWJzY3JpcHRpb24iLCJyZW1vdmVTdWJzY3JpcHRpb24iLCJzdWJzY3JpcHRpb24iLCJlbWl0dGVyIiwic3Vic2NyaXB0aW9ucyIsImdldFN1YnNjcmlwdGlvbnNGb3JUeXBlIiwibWFwIiwiaSIsImwiLCJsZW5ndGgiLCJBcnJheSIsInByb3RvdHlwZSIsInNsaWNlIiwiY2FsbCIsImFyZ3VtZW50cyIsInJlbW92ZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQVdBOzs7Ozs7OztBQUVBLElBQU1BLG1CQUFtQixHQUFHQyxPQUFPLENBQUMscUJBQUQsQ0FBbkM7O0FBQ0EsSUFBTUMsdUJBQXVCLEdBQUdELE9BQU8sQ0FBQyx5QkFBRCxDQUF2Qzs7QUFFQSxJQUFNRSxTQUFTLEdBQUdGLE9BQU8sQ0FBQyxXQUFELENBQXpCOztJQWVNRyxZO0FBVUosd0JBQVlDLFVBQVosRUFBa0Q7QUFBQTtBQUNoRCxTQUFLQyxXQUFMLEdBQW1CRCxVQUFVLElBQUksSUFBSUgsdUJBQUosRUFBakM7QUFDRDs7OztnQ0FpQkNLLFMsRUFDQUMsUSxFQUNBQyxPLEVBQ3FCO0FBQ3JCLGFBQVEsS0FBS0gsV0FBTCxDQUFpQkksZUFBakIsQ0FDTkgsU0FETSxFQUVOLElBQUlQLG1CQUFKLENBQXdCLElBQXhCLEVBQThCLEtBQUtNLFdBQW5DLEVBQWdERSxRQUFoRCxFQUEwREMsT0FBMUQsQ0FGTSxDQUFSO0FBSUQ7Ozt5QkFhQ0YsUyxFQUNBQyxRLEVBQ0FDLE8sRUFDcUI7QUFBQTs7QUFDckIsYUFBTyxLQUFLRSxXQUFMLENBQWlCSixTQUFqQixFQUE0QixZQUFhO0FBQzlDLFFBQUEsS0FBSSxDQUFDSyxxQkFBTDs7QUFEOEMsMENBQVRDLElBQVM7QUFBVEEsVUFBQUEsSUFBUztBQUFBOztBQUU5Q0wsUUFBQUEsUUFBUSxDQUFDTSxLQUFULENBQWVMLE9BQWYsRUFBd0JJLElBQXhCO0FBQ0QsT0FITSxDQUFQO0FBSUQ7Ozt1Q0FTa0JOLFMsRUFBb0I7QUFDckMsV0FBS0QsV0FBTCxDQUFpQlMsc0JBQWpCLENBQXdDUixTQUF4QztBQUNEOzs7NENBdUJ1QjtBQUN0QkosTUFBQUEsU0FBUyxDQUNQLENBQUMsQ0FBQyxLQUFLYSxvQkFEQSxFQUVQLDREQUZPLENBQVQ7QUFJQSxXQUFLQyxrQkFBTCxDQUF3QixLQUFLRCxvQkFBN0I7QUFDRDs7O3VDQU1rQkUsWSxFQUFtQztBQUNwRGYsTUFBQUEsU0FBUyxDQUNQZSxZQUFZLENBQUNDLE9BQWIsS0FBeUIsSUFEbEIsRUFFUCwrQ0FGTyxDQUFUOztBQUlBLFdBQUtiLFdBQUwsQ0FBaUJXLGtCQUFqQixDQUFvQ0MsWUFBcEM7QUFDRDs7OzhCQVNTWCxTLEVBQTBDO0FBQ2xELFVBQU1hLGFBQWEsR0FBRyxLQUFLZCxXQUFMLENBQWlCZSx1QkFBakIsQ0FBeUNkLFNBQXpDLENBQXRCOztBQUNBLGFBQU9hLGFBQWEsR0FDaEJBLGFBQWEsQ0FBQ0UsR0FBZCxDQUFrQixVQUFBSixZQUFZO0FBQUEsZUFBSUEsWUFBWSxDQUFDVixRQUFqQjtBQUFBLE9BQTlCLENBRGdCLEdBRWhCLEVBRko7QUFHRDs7O3lCQWdCSUQsUyxFQUFtQjtBQUN0QixVQUFNYSxhQUFhLEdBQUcsS0FBS2QsV0FBTCxDQUFpQmUsdUJBQWpCLENBQXlDZCxTQUF6QyxDQUF0Qjs7QUFDQSxVQUFJYSxhQUFKLEVBQW1CO0FBQ2pCLGFBQUssSUFBSUcsQ0FBQyxHQUFHLENBQVIsRUFBV0MsQ0FBQyxHQUFHSixhQUFhLENBQUNLLE1BQWxDLEVBQTBDRixDQUFDLEdBQUdDLENBQTlDLEVBQWlERCxDQUFDLEVBQWxELEVBQXNEO0FBQ3BELGNBQU1MLFlBQVksR0FBR0UsYUFBYSxDQUFDRyxDQUFELENBQWxDOztBQUdBLGNBQUlMLFlBQVksSUFBSUEsWUFBWSxDQUFDVixRQUFqQyxFQUEyQztBQUN6QyxpQkFBS1Esb0JBQUwsR0FBNEJFLFlBQTVCO0FBQ0FBLFlBQUFBLFlBQVksQ0FBQ1YsUUFBYixDQUFzQk0sS0FBdEIsQ0FDRUksWUFBWSxDQUFDVCxPQURmLEVBRUVpQixLQUFLLENBQUNDLFNBQU4sQ0FBZ0JDLEtBQWhCLENBQXNCQyxJQUF0QixDQUEyQkMsU0FBM0IsRUFBc0MsQ0FBdEMsQ0FGRjtBQUlEO0FBQ0Y7O0FBQ0QsYUFBS2Qsb0JBQUwsR0FBNEIsSUFBNUI7QUFDRDtBQUNGOzs7bUNBZWNULFMsRUFBbUJDLFEsRUFBVTtBQUMxQyxVQUFNWSxhQUFhLEdBQUcsS0FBS2QsV0FBTCxDQUFpQmUsdUJBQWpCLENBQXlDZCxTQUF6QyxDQUF0Qjs7QUFDQSxVQUFJYSxhQUFKLEVBQW1CO0FBQ2pCLGFBQUssSUFBSUcsQ0FBQyxHQUFHLENBQVIsRUFBV0MsQ0FBQyxHQUFHSixhQUFhLENBQUNLLE1BQWxDLEVBQTBDRixDQUFDLEdBQUdDLENBQTlDLEVBQWlERCxDQUFDLEVBQWxELEVBQXNEO0FBQ3BELGNBQU1MLFlBQVksR0FBR0UsYUFBYSxDQUFDRyxDQUFELENBQWxDOztBQUlBLGNBQUlMLFlBQVksSUFBSUEsWUFBWSxDQUFDVixRQUFiLEtBQTBCQSxRQUE5QyxFQUF3RDtBQUN0RFUsWUFBQUEsWUFBWSxDQUFDYSxNQUFiO0FBQ0Q7QUFDRjtBQUNGO0FBQ0Y7Ozs7O0FBR0hDLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjdCLFlBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZm9ybWF0XG4gKiBAbm9mbG93XG4gKiBAdHlwZWNoZWNrXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBFbWl0dGVyU3Vic2NyaXB0aW9uID0gcmVxdWlyZSgnRW1pdHRlclN1YnNjcmlwdGlvbicpO1xuY29uc3QgRXZlbnRTdWJzY3JpcHRpb25WZW5kb3IgPSByZXF1aXJlKCdFdmVudFN1YnNjcmlwdGlvblZlbmRvcicpO1xuXG5jb25zdCBpbnZhcmlhbnQgPSByZXF1aXJlKCdpbnZhcmlhbnQnKTtcblxuLyoqXG4gKiBAY2xhc3MgRXZlbnRFbWl0dGVyXG4gKiBAZGVzY3JpcHRpb25cbiAqIEFuIEV2ZW50RW1pdHRlciBpcyByZXNwb25zaWJsZSBmb3IgbWFuYWdpbmcgYSBzZXQgb2YgbGlzdGVuZXJzIGFuZCBwdWJsaXNoaW5nXG4gKiBldmVudHMgdG8gdGhlbSB3aGVuIGl0IGlzIHRvbGQgdGhhdCBzdWNoIGV2ZW50cyBoYXBwZW5lZC4gSW4gYWRkaXRpb24gdG8gdGhlXG4gKiBkYXRhIGZvciB0aGUgZ2l2ZW4gZXZlbnQgaXQgYWxzbyBzZW5kcyBhIGV2ZW50IGNvbnRyb2wgb2JqZWN0IHdoaWNoIGFsbG93c1xuICogdGhlIGxpc3RlbmVycy9oYW5kbGVycyB0byBwcmV2ZW50IHRoZSBkZWZhdWx0IGJlaGF2aW9yIG9mIHRoZSBnaXZlbiBldmVudC5cbiAqXG4gKiBUaGUgZW1pdHRlciBpcyBkZXNpZ25lZCB0byBiZSBnZW5lcmljIGVub3VnaCB0byBzdXBwb3J0IGFsbCB0aGUgZGlmZmVyZW50XG4gKiBjb250ZXh0cyBpbiB3aGljaCBvbmUgbWlnaHQgd2FudCB0byBlbWl0IGV2ZW50cy4gSXQgaXMgYSBzaW1wbGUgbXVsdGljYXN0XG4gKiBtZWNoYW5pc20gb24gdG9wIG9mIHdoaWNoIGV4dHJhIGZ1bmN0aW9uYWxpdHkgY2FuIGJlIGNvbXBvc2VkLiBGb3IgZXhhbXBsZSwgYVxuICogbW9yZSBhZHZhbmNlZCBlbWl0dGVyIG1heSB1c2UgYW4gRXZlbnRIb2xkZXIgYW5kIEV2ZW50RmFjdG9yeS5cbiAqL1xuY2xhc3MgRXZlbnRFbWl0dGVyIHtcbiAgX3N1YnNjcmliZXI6IEV2ZW50U3Vic2NyaXB0aW9uVmVuZG9yO1xuICBfY3VycmVudFN1YnNjcmlwdGlvbjogP0VtaXR0ZXJTdWJzY3JpcHRpb247XG5cbiAgLyoqXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKlxuICAgKiBAcGFyYW0ge0V2ZW50U3Vic2NyaXB0aW9uVmVuZG9yfSBzdWJzY3JpYmVyIC0gT3B0aW9uYWwgc3Vic2NyaWJlciBpbnN0YW5jZVxuICAgKiAgIHRvIHVzZS4gSWYgb21pdHRlZCwgYSBuZXcgc3Vic2NyaWJlciB3aWxsIGJlIGNyZWF0ZWQgZm9yIHRoZSBlbWl0dGVyLlxuICAgKi9cbiAgY29uc3RydWN0b3Ioc3Vic2NyaWJlcjogP0V2ZW50U3Vic2NyaXB0aW9uVmVuZG9yKSB7XG4gICAgdGhpcy5fc3Vic2NyaWJlciA9IHN1YnNjcmliZXIgfHwgbmV3IEV2ZW50U3Vic2NyaXB0aW9uVmVuZG9yKCk7XG4gIH1cblxuICAvKipcbiAgICogQWRkcyBhIGxpc3RlbmVyIHRvIGJlIGludm9rZWQgd2hlbiBldmVudHMgb2YgdGhlIHNwZWNpZmllZCB0eXBlIGFyZVxuICAgKiBlbWl0dGVkLiBBbiBvcHRpb25hbCBjYWxsaW5nIGNvbnRleHQgbWF5IGJlIHByb3ZpZGVkLiBUaGUgZGF0YSBhcmd1bWVudHNcbiAgICogZW1pdHRlZCB3aWxsIGJlIHBhc3NlZCB0byB0aGUgbGlzdGVuZXIgZnVuY3Rpb24uXG4gICAqXG4gICAqIFRPRE86IEFubm90YXRlIHRoZSBsaXN0ZW5lciBhcmcncyB0eXBlLiBUaGlzIGlzIHRyaWNreSBiZWNhdXNlIGxpc3RlbmVyc1xuICAgKiAgICAgICBjYW4gYmUgaW52b2tlZCB3aXRoIHZhcmFyZ3MuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudFR5cGUgLSBOYW1lIG9mIHRoZSBldmVudCB0byBsaXN0ZW4gdG9cbiAgICogQHBhcmFtIHtmdW5jdGlvbn0gbGlzdGVuZXIgLSBGdW5jdGlvbiB0byBpbnZva2Ugd2hlbiB0aGUgc3BlY2lmaWVkIGV2ZW50IGlzXG4gICAqICAgZW1pdHRlZFxuICAgKiBAcGFyYW0geyp9IGNvbnRleHQgLSBPcHRpb25hbCBjb250ZXh0IG9iamVjdCB0byB1c2Ugd2hlbiBpbnZva2luZyB0aGVcbiAgICogICBsaXN0ZW5lclxuICAgKi9cbiAgYWRkTGlzdGVuZXIoXG4gICAgZXZlbnRUeXBlOiBzdHJpbmcsXG4gICAgbGlzdGVuZXI6IEZ1bmN0aW9uLFxuICAgIGNvbnRleHQ6ID9PYmplY3QsXG4gICk6IEVtaXR0ZXJTdWJzY3JpcHRpb24ge1xuICAgIHJldHVybiAodGhpcy5fc3Vic2NyaWJlci5hZGRTdWJzY3JpcHRpb24oXG4gICAgICBldmVudFR5cGUsXG4gICAgICBuZXcgRW1pdHRlclN1YnNjcmlwdGlvbih0aGlzLCB0aGlzLl9zdWJzY3JpYmVyLCBsaXN0ZW5lciwgY29udGV4dCksXG4gICAgKTogYW55KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaW1pbGFyIHRvIGFkZExpc3RlbmVyLCBleGNlcHQgdGhhdCB0aGUgbGlzdGVuZXIgaXMgcmVtb3ZlZCBhZnRlciBpdCBpc1xuICAgKiBpbnZva2VkIG9uY2UuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudFR5cGUgLSBOYW1lIG9mIHRoZSBldmVudCB0byBsaXN0ZW4gdG9cbiAgICogQHBhcmFtIHtmdW5jdGlvbn0gbGlzdGVuZXIgLSBGdW5jdGlvbiB0byBpbnZva2Ugb25seSBvbmNlIHdoZW4gdGhlXG4gICAqICAgc3BlY2lmaWVkIGV2ZW50IGlzIGVtaXR0ZWRcbiAgICogQHBhcmFtIHsqfSBjb250ZXh0IC0gT3B0aW9uYWwgY29udGV4dCBvYmplY3QgdG8gdXNlIHdoZW4gaW52b2tpbmcgdGhlXG4gICAqICAgbGlzdGVuZXJcbiAgICovXG4gIG9uY2UoXG4gICAgZXZlbnRUeXBlOiBzdHJpbmcsXG4gICAgbGlzdGVuZXI6IEZ1bmN0aW9uLFxuICAgIGNvbnRleHQ6ID9PYmplY3QsXG4gICk6IEVtaXR0ZXJTdWJzY3JpcHRpb24ge1xuICAgIHJldHVybiB0aGlzLmFkZExpc3RlbmVyKGV2ZW50VHlwZSwgKC4uLmFyZ3MpID0+IHtcbiAgICAgIHRoaXMucmVtb3ZlQ3VycmVudExpc3RlbmVyKCk7XG4gICAgICBsaXN0ZW5lci5hcHBseShjb250ZXh0LCBhcmdzKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmVzIGFsbCBvZiB0aGUgcmVnaXN0ZXJlZCBsaXN0ZW5lcnMsIGluY2x1ZGluZyB0aG9zZSByZWdpc3RlcmVkIGFzXG4gICAqIGxpc3RlbmVyIG1hcHMuXG4gICAqXG4gICAqIEBwYXJhbSB7P3N0cmluZ30gZXZlbnRUeXBlIC0gT3B0aW9uYWwgbmFtZSBvZiB0aGUgZXZlbnQgd2hvc2UgcmVnaXN0ZXJlZFxuICAgKiAgIGxpc3RlbmVycyB0byByZW1vdmVcbiAgICovXG4gIHJlbW92ZUFsbExpc3RlbmVycyhldmVudFR5cGU6ID9zdHJpbmcpIHtcbiAgICB0aGlzLl9zdWJzY3JpYmVyLnJlbW92ZUFsbFN1YnNjcmlwdGlvbnMoZXZlbnRUeXBlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcm92aWRlcyBhbiBBUEkgdGhhdCBjYW4gYmUgY2FsbGVkIGR1cmluZyBhbiBldmVudGluZyBjeWNsZSB0byByZW1vdmUgdGhlXG4gICAqIGxhc3QgbGlzdGVuZXIgdGhhdCB3YXMgaW52b2tlZC4gVGhpcyBhbGxvd3MgYSBkZXZlbG9wZXIgdG8gcHJvdmlkZSBhbiBldmVudFxuICAgKiBvYmplY3QgdGhhdCBjYW4gcmVtb3ZlIHRoZSBsaXN0ZW5lciAob3IgbGlzdGVuZXIgbWFwKSBkdXJpbmcgdGhlXG4gICAqIGludm9jYXRpb24uXG4gICAqXG4gICAqIElmIGl0IGlzIGNhbGxlZCB3aGVuIG5vdCBpbnNpZGUgb2YgYW4gZW1pdHRpbmcgY3ljbGUgaXQgd2lsbCB0aHJvdy5cbiAgICpcbiAgICogQHRocm93cyB7RXJyb3J9IFdoZW4gY2FsbGVkIG5vdCBkdXJpbmcgYW4gZXZlbnRpbmcgY3ljbGVcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogICB2YXIgc3Vic2NyaXB0aW9uID0gZW1pdHRlci5hZGRMaXN0ZW5lck1hcCh7XG4gICAqICAgICBzb21lRXZlbnQ6IGZ1bmN0aW9uKGRhdGEsIGV2ZW50KSB7XG4gICAqICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgKiAgICAgICBlbWl0dGVyLnJlbW92ZUN1cnJlbnRMaXN0ZW5lcigpO1xuICAgKiAgICAgfVxuICAgKiAgIH0pO1xuICAgKlxuICAgKiAgIGVtaXR0ZXIuZW1pdCgnc29tZUV2ZW50JywgJ2FiYycpOyAvLyBsb2dzICdhYmMnXG4gICAqICAgZW1pdHRlci5lbWl0KCdzb21lRXZlbnQnLCAnZGVmJyk7IC8vIGRvZXMgbm90IGxvZyBhbnl0aGluZ1xuICAgKi9cbiAgcmVtb3ZlQ3VycmVudExpc3RlbmVyKCkge1xuICAgIGludmFyaWFudChcbiAgICAgICEhdGhpcy5fY3VycmVudFN1YnNjcmlwdGlvbixcbiAgICAgICdOb3QgaW4gYW4gZW1pdHRpbmcgY3ljbGU7IHRoZXJlIGlzIG5vIGN1cnJlbnQgc3Vic2NyaXB0aW9uJyxcbiAgICApO1xuICAgIHRoaXMucmVtb3ZlU3Vic2NyaXB0aW9uKHRoaXMuX2N1cnJlbnRTdWJzY3JpcHRpb24pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZXMgYSBzcGVjaWZpYyBzdWJzY3JpcHRpb24uIENhbGxlZCBieSB0aGUgYHJlbW92ZSgpYCBtZXRob2Qgb2YgdGhlXG4gICAqIHN1YnNjcmlwdGlvbiBpdHNlbGYgdG8gZW5zdXJlIGFueSBuZWNlc3NhcnkgY2xlYW51cCBpcyBwZXJmb3JtZWQuXG4gICAqL1xuICByZW1vdmVTdWJzY3JpcHRpb24oc3Vic2NyaXB0aW9uOiBFbWl0dGVyU3Vic2NyaXB0aW9uKSB7XG4gICAgaW52YXJpYW50KFxuICAgICAgc3Vic2NyaXB0aW9uLmVtaXR0ZXIgPT09IHRoaXMsXG4gICAgICAnU3Vic2NyaXB0aW9uIGRvZXMgbm90IGJlbG9uZyB0byB0aGlzIGVtaXR0ZXIuJyxcbiAgICApO1xuICAgIHRoaXMuX3N1YnNjcmliZXIucmVtb3ZlU3Vic2NyaXB0aW9uKHN1YnNjcmlwdGlvbik7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhbiBhcnJheSBvZiBsaXN0ZW5lcnMgdGhhdCBhcmUgY3VycmVudGx5IHJlZ2lzdGVyZWQgZm9yIHRoZSBnaXZlblxuICAgKiBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50VHlwZSAtIE5hbWUgb2YgdGhlIGV2ZW50IHRvIHF1ZXJ5XG4gICAqIEByZXR1cm5zIHthcnJheX1cbiAgICovXG4gIGxpc3RlbmVycyhldmVudFR5cGU6IHN0cmluZyk6IFtFbWl0dGVyU3Vic2NyaXB0aW9uXSB7XG4gICAgY29uc3Qgc3Vic2NyaXB0aW9ucyA9IHRoaXMuX3N1YnNjcmliZXIuZ2V0U3Vic2NyaXB0aW9uc0ZvclR5cGUoZXZlbnRUeXBlKTtcbiAgICByZXR1cm4gc3Vic2NyaXB0aW9uc1xuICAgICAgPyBzdWJzY3JpcHRpb25zLm1hcChzdWJzY3JpcHRpb24gPT4gc3Vic2NyaXB0aW9uLmxpc3RlbmVyKVxuICAgICAgOiBbXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbWl0cyBhbiBldmVudCBvZiB0aGUgZ2l2ZW4gdHlwZSB3aXRoIHRoZSBnaXZlbiBkYXRhLiBBbGwgaGFuZGxlcnMgb2YgdGhhdFxuICAgKiBwYXJ0aWN1bGFyIHR5cGUgd2lsbCBiZSBub3RpZmllZC5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50VHlwZSAtIE5hbWUgb2YgdGhlIGV2ZW50IHRvIGVtaXRcbiAgICogQHBhcmFtIHsuLi4qfSBBcmJpdHJhcnkgYXJndW1lbnRzIHRvIGJlIHBhc3NlZCB0byBlYWNoIHJlZ2lzdGVyZWQgbGlzdGVuZXJcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogICBlbWl0dGVyLmFkZExpc3RlbmVyKCdzb21lRXZlbnQnLCBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAqICAgICBjb25zb2xlLmxvZyhtZXNzYWdlKTtcbiAgICogICB9KTtcbiAgICpcbiAgICogICBlbWl0dGVyLmVtaXQoJ3NvbWVFdmVudCcsICdhYmMnKTsgLy8gbG9ncyAnYWJjJ1xuICAgKi9cbiAgZW1pdChldmVudFR5cGU6IHN0cmluZykge1xuICAgIGNvbnN0IHN1YnNjcmlwdGlvbnMgPSB0aGlzLl9zdWJzY3JpYmVyLmdldFN1YnNjcmlwdGlvbnNGb3JUeXBlKGV2ZW50VHlwZSk7XG4gICAgaWYgKHN1YnNjcmlwdGlvbnMpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gc3Vic2NyaXB0aW9ucy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gc3Vic2NyaXB0aW9uc1tpXTtcblxuICAgICAgICAvLyBUaGUgc3Vic2NyaXB0aW9uIG1heSBoYXZlIGJlZW4gcmVtb3ZlZCBkdXJpbmcgdGhpcyBldmVudCBsb29wLlxuICAgICAgICBpZiAoc3Vic2NyaXB0aW9uICYmIHN1YnNjcmlwdGlvbi5saXN0ZW5lcikge1xuICAgICAgICAgIHRoaXMuX2N1cnJlbnRTdWJzY3JpcHRpb24gPSBzdWJzY3JpcHRpb247XG4gICAgICAgICAgc3Vic2NyaXB0aW9uLmxpc3RlbmVyLmFwcGx5KFxuICAgICAgICAgICAgc3Vic2NyaXB0aW9uLmNvbnRleHQsXG4gICAgICAgICAgICBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMuX2N1cnJlbnRTdWJzY3JpcHRpb24gPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmVzIHRoZSBnaXZlbiBsaXN0ZW5lciBmb3IgZXZlbnQgb2Ygc3BlY2lmaWMgdHlwZS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50VHlwZSAtIE5hbWUgb2YgdGhlIGV2ZW50IHRvIGVtaXRcbiAgICogQHBhcmFtIHtmdW5jdGlvbn0gbGlzdGVuZXIgLSBGdW5jdGlvbiB0byBpbnZva2Ugd2hlbiB0aGUgc3BlY2lmaWVkIGV2ZW50IGlzXG4gICAqICAgZW1pdHRlZFxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAgIGVtaXR0ZXIucmVtb3ZlTGlzdGVuZXIoJ3NvbWVFdmVudCcsIGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICogICAgIGNvbnNvbGUubG9nKG1lc3NhZ2UpO1xuICAgKiAgIH0pOyAvLyByZW1vdmVzIHRoZSBsaXN0ZW5lciBpZiBhbHJlYWR5IHJlZ2lzdGVyZWRcbiAgICpcbiAgICovXG4gIHJlbW92ZUxpc3RlbmVyKGV2ZW50VHlwZTogU3RyaW5nLCBsaXN0ZW5lcikge1xuICAgIGNvbnN0IHN1YnNjcmlwdGlvbnMgPSB0aGlzLl9zdWJzY3JpYmVyLmdldFN1YnNjcmlwdGlvbnNGb3JUeXBlKGV2ZW50VHlwZSk7XG4gICAgaWYgKHN1YnNjcmlwdGlvbnMpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gc3Vic2NyaXB0aW9ucy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gc3Vic2NyaXB0aW9uc1tpXTtcblxuICAgICAgICAvLyBUaGUgc3Vic2NyaXB0aW9uIG1heSBoYXZlIGJlZW4gcmVtb3ZlZCBkdXJpbmcgdGhpcyBldmVudCBsb29wLlxuICAgICAgICAvLyBpdHMgbGlzdGVuZXIgbWF0Y2hlcyB0aGUgbGlzdGVuZXIgaW4gbWV0aG9kIHBhcmFtZXRlcnNcbiAgICAgICAgaWYgKHN1YnNjcmlwdGlvbiAmJiBzdWJzY3JpcHRpb24ubGlzdGVuZXIgPT09IGxpc3RlbmVyKSB7XG4gICAgICAgICAgc3Vic2NyaXB0aW9uLnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gRXZlbnRFbWl0dGVyO1xuIl19