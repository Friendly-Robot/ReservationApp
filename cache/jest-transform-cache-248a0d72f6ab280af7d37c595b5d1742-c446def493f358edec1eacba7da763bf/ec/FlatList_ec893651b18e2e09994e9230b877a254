e1586785c24ed50734b78c010fae33f3
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));

var Platform = require('Platform');

var deepDiffer = require('deepDiffer');

var React = require('React');

var View = require('View');

var VirtualizedList = require('VirtualizedList');

var StyleSheet = require('StyleSheet');

var invariant = require('invariant');

var defaultProps = (0, _objectSpread2.default)({}, VirtualizedList.defaultProps, {
  numColumns: 1,
  removeClippedSubviews: Platform.OS === 'android'
});

var FlatList = function (_React$PureComponent) {
  (0, _inherits2.default)(FlatList, _React$PureComponent);
  (0, _createClass2.default)(FlatList, [{
    key: "scrollToEnd",
    value: function scrollToEnd(params) {
      if (this._listRef) {
        this._listRef.scrollToEnd(params);
      }
    }
  }, {
    key: "scrollToIndex",
    value: function scrollToIndex(params) {
      if (this._listRef) {
        this._listRef.scrollToIndex(params);
      }
    }
  }, {
    key: "scrollToItem",
    value: function scrollToItem(params) {
      if (this._listRef) {
        this._listRef.scrollToItem(params);
      }
    }
  }, {
    key: "scrollToOffset",
    value: function scrollToOffset(params) {
      if (this._listRef) {
        this._listRef.scrollToOffset(params);
      }
    }
  }, {
    key: "recordInteraction",
    value: function recordInteraction() {
      if (this._listRef) {
        this._listRef.recordInteraction();
      }
    }
  }, {
    key: "flashScrollIndicators",
    value: function flashScrollIndicators() {
      if (this._listRef) {
        this._listRef.flashScrollIndicators();
      }
    }
  }, {
    key: "getScrollResponder",
    value: function getScrollResponder() {
      if (this._listRef) {
        return this._listRef.getScrollResponder();
      }
    }
  }, {
    key: "getScrollableNode",
    value: function getScrollableNode() {
      if (this._listRef) {
        return this._listRef.getScrollableNode();
      }
    }
  }, {
    key: "setNativeProps",
    value: function setNativeProps(props) {
      if (this._listRef) {
        this._listRef.setNativeProps(props);
      }
    }
  }]);

  function FlatList(props) {
    var _this;

    (0, _classCallCheck2.default)(this, FlatList);
    _this = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(FlatList).call(this, props));
    _this._virtualizedListPairs = [];

    _this._captureRef = function (ref) {
      _this._listRef = ref;
    };

    _this._getItem = function (data, index) {
      var numColumns = _this.props.numColumns;

      if (numColumns > 1) {
        var ret = [];

        for (var kk = 0; kk < numColumns; kk++) {
          var _item = data[index * numColumns + kk];

          if (_item != null) {
            ret.push(_item);
          }
        }

        return ret;
      } else {
        return data[index];
      }
    };

    _this._getItemCount = function (data) {
      return data ? Math.ceil(data.length / _this.props.numColumns) : 0;
    };

    _this._keyExtractor = function (items, index) {
      var _this$props = _this.props,
          keyExtractor = _this$props.keyExtractor,
          numColumns = _this$props.numColumns;

      if (numColumns > 1) {
        invariant(Array.isArray(items), 'FlatList: Encountered internal consistency error, expected each item to consist of an ' + 'array with 1-%s columns; instead, received a single item.', numColumns);
        return items.map(function (it, kk) {
          return keyExtractor(it, index * numColumns + kk);
        }).join(':');
      } else {
        return keyExtractor(items, index);
      }
    };

    _this._renderItem = function (info) {
      var _this$props2 = _this.props,
          renderItem = _this$props2.renderItem,
          numColumns = _this$props2.numColumns,
          columnWrapperStyle = _this$props2.columnWrapperStyle;

      if (numColumns > 1) {
        var _item2 = info.item,
            _index = info.index;
        invariant(Array.isArray(_item2), 'Expected array of items with numColumns > 1');
        return React.createElement(View, {
          style: StyleSheet.compose(styles.row, columnWrapperStyle)
        }, _item2.map(function (it, kk) {
          var element = renderItem({
            item: it,
            index: _index * numColumns + kk,
            separators: info.separators
          });
          return element && React.cloneElement(element, {
            key: kk
          });
        }));
      } else {
        return renderItem(info);
      }
    };

    _this._checkProps(_this.props);

    if (_this.props.viewabilityConfigCallbackPairs) {
      _this._virtualizedListPairs = _this.props.viewabilityConfigCallbackPairs.map(function (pair) {
        return {
          viewabilityConfig: pair.viewabilityConfig,
          onViewableItemsChanged: _this._createOnViewableItemsChanged(pair.onViewableItemsChanged)
        };
      });
    } else if (_this.props.onViewableItemsChanged) {
      _this._virtualizedListPairs.push({
        viewabilityConfig: _this.props.viewabilityConfig,
        onViewableItemsChanged: _this._createOnViewableItemsChanged(_this.props.onViewableItemsChanged)
      });
    }

    return _this;
  }

  (0, _createClass2.default)(FlatList, [{
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps) {
      invariant(prevProps.numColumns === this.props.numColumns, 'Changing numColumns on the fly is not supported. Change the key prop on FlatList when ' + 'changing the number of columns to force a fresh render of the component.');
      invariant(prevProps.onViewableItemsChanged === this.props.onViewableItemsChanged, 'Changing onViewableItemsChanged on the fly is not supported');
      invariant(!deepDiffer(prevProps.viewabilityConfig, this.props.viewabilityConfig), 'Changing viewabilityConfig on the fly is not supported');
      invariant(prevProps.viewabilityConfigCallbackPairs === this.props.viewabilityConfigCallbackPairs, 'Changing viewabilityConfigCallbackPairs on the fly is not supported');

      this._checkProps(this.props);
    }
  }, {
    key: "_checkProps",
    value: function _checkProps(props) {
      var getItem = props.getItem,
          getItemCount = props.getItemCount,
          horizontal = props.horizontal,
          numColumns = props.numColumns,
          columnWrapperStyle = props.columnWrapperStyle,
          onViewableItemsChanged = props.onViewableItemsChanged,
          viewabilityConfigCallbackPairs = props.viewabilityConfigCallbackPairs;
      invariant(!getItem && !getItemCount, 'FlatList does not support custom data formats.');

      if (numColumns > 1) {
        invariant(!horizontal, 'numColumns does not support horizontal.');
      } else {
        invariant(!columnWrapperStyle, 'columnWrapperStyle not supported for single column lists');
      }

      invariant(!(onViewableItemsChanged && viewabilityConfigCallbackPairs), 'FlatList does not support setting both onViewableItemsChanged and ' + 'viewabilityConfigCallbackPairs.');
    }
  }, {
    key: "_pushMultiColumnViewable",
    value: function _pushMultiColumnViewable(arr, v) {
      var _this$props3 = this.props,
          numColumns = _this$props3.numColumns,
          keyExtractor = _this$props3.keyExtractor;
      v.item.forEach(function (item, ii) {
        invariant(v.index != null, 'Missing index!');
        var index = v.index * numColumns + ii;
        arr.push((0, _objectSpread2.default)({}, v, {
          item: item,
          key: keyExtractor(item, index),
          index: index
        }));
      });
    }
  }, {
    key: "_createOnViewableItemsChanged",
    value: function _createOnViewableItemsChanged(onViewableItemsChanged) {
      var _this2 = this;

      return function (info) {
        var numColumns = _this2.props.numColumns;

        if (onViewableItemsChanged) {
          if (numColumns > 1) {
            var changed = [];
            var viewableItems = [];
            info.viewableItems.forEach(function (v) {
              return _this2._pushMultiColumnViewable(viewableItems, v);
            });
            info.changed.forEach(function (v) {
              return _this2._pushMultiColumnViewable(changed, v);
            });
            onViewableItemsChanged({
              viewableItems: viewableItems,
              changed: changed
            });
          } else {
            onViewableItemsChanged(info);
          }
        }
      };
    }
  }, {
    key: "render",
    value: function render() {
      return React.createElement(VirtualizedList, (0, _extends2.default)({}, this.props, {
        renderItem: this._renderItem,
        getItem: this._getItem,
        getItemCount: this._getItemCount,
        keyExtractor: this._keyExtractor,
        ref: this._captureRef,
        viewabilityConfigCallbackPairs: this._virtualizedListPairs
      }));
    }
  }]);
  return FlatList;
}(React.PureComponent);

FlatList.defaultProps = defaultProps;
var styles = StyleSheet.create({
  row: {
    flexDirection: 'row'
  }
});
module.exports = FlatList;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkZsYXRMaXN0LmpzIl0sIm5hbWVzIjpbIlBsYXRmb3JtIiwicmVxdWlyZSIsImRlZXBEaWZmZXIiLCJSZWFjdCIsIlZpZXciLCJWaXJ0dWFsaXplZExpc3QiLCJTdHlsZVNoZWV0IiwiaW52YXJpYW50IiwiZGVmYXVsdFByb3BzIiwibnVtQ29sdW1ucyIsInJlbW92ZUNsaXBwZWRTdWJ2aWV3cyIsIk9TIiwiRmxhdExpc3QiLCJwYXJhbXMiLCJfbGlzdFJlZiIsInNjcm9sbFRvRW5kIiwic2Nyb2xsVG9JbmRleCIsInNjcm9sbFRvSXRlbSIsInNjcm9sbFRvT2Zmc2V0IiwicmVjb3JkSW50ZXJhY3Rpb24iLCJmbGFzaFNjcm9sbEluZGljYXRvcnMiLCJnZXRTY3JvbGxSZXNwb25kZXIiLCJnZXRTY3JvbGxhYmxlTm9kZSIsInByb3BzIiwic2V0TmF0aXZlUHJvcHMiLCJfdmlydHVhbGl6ZWRMaXN0UGFpcnMiLCJfY2FwdHVyZVJlZiIsInJlZiIsIl9nZXRJdGVtIiwiZGF0YSIsImluZGV4IiwicmV0Iiwia2siLCJpdGVtIiwicHVzaCIsIl9nZXRJdGVtQ291bnQiLCJNYXRoIiwiY2VpbCIsImxlbmd0aCIsIl9rZXlFeHRyYWN0b3IiLCJpdGVtcyIsImtleUV4dHJhY3RvciIsIkFycmF5IiwiaXNBcnJheSIsIm1hcCIsIml0Iiwiam9pbiIsIl9yZW5kZXJJdGVtIiwiaW5mbyIsInJlbmRlckl0ZW0iLCJjb2x1bW5XcmFwcGVyU3R5bGUiLCJjb21wb3NlIiwic3R5bGVzIiwicm93IiwiZWxlbWVudCIsInNlcGFyYXRvcnMiLCJjbG9uZUVsZW1lbnQiLCJrZXkiLCJfY2hlY2tQcm9wcyIsInZpZXdhYmlsaXR5Q29uZmlnQ2FsbGJhY2tQYWlycyIsInBhaXIiLCJ2aWV3YWJpbGl0eUNvbmZpZyIsIm9uVmlld2FibGVJdGVtc0NoYW5nZWQiLCJfY3JlYXRlT25WaWV3YWJsZUl0ZW1zQ2hhbmdlZCIsInByZXZQcm9wcyIsImdldEl0ZW0iLCJnZXRJdGVtQ291bnQiLCJob3Jpem9udGFsIiwiYXJyIiwidiIsImZvckVhY2giLCJpaSIsImNoYW5nZWQiLCJ2aWV3YWJsZUl0ZW1zIiwiX3B1c2hNdWx0aUNvbHVtblZpZXdhYmxlIiwiUHVyZUNvbXBvbmVudCIsImNyZWF0ZSIsImZsZXhEaXJlY3Rpb24iLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFTQTs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUEsSUFBTUEsUUFBUSxHQUFHQyxPQUFPLENBQUMsVUFBRCxDQUF4Qjs7QUFDQSxJQUFNQyxVQUFVLEdBQUdELE9BQU8sQ0FBQyxZQUFELENBQTFCOztBQUNBLElBQU1FLEtBQUssR0FBR0YsT0FBTyxDQUFDLE9BQUQsQ0FBckI7O0FBQ0EsSUFBTUcsSUFBSSxHQUFHSCxPQUFPLENBQUMsTUFBRCxDQUFwQjs7QUFDQSxJQUFNSSxlQUFlLEdBQUdKLE9BQU8sQ0FBQyxpQkFBRCxDQUEvQjs7QUFDQSxJQUFNSyxVQUFVLEdBQUdMLE9BQU8sQ0FBQyxZQUFELENBQTFCOztBQUVBLElBQU1NLFNBQVMsR0FBR04sT0FBTyxDQUFDLFdBQUQsQ0FBekI7O0FBeU1BLElBQU1PLFlBQVksbUNBQ2JILGVBQWUsQ0FBQ0csWUFESDtBQUVoQkMsRUFBQUEsVUFBVSxFQUFFLENBRkk7QUFRaEJDLEVBQUFBLHFCQUFxQixFQUFFVixRQUFRLENBQUNXLEVBQVQsS0FBZ0I7QUFSdkIsRUFBbEI7O0lBd0hNQyxROzs7O2dDQU1RQyxNLEVBQWlDO0FBQzNDLFVBQUksS0FBS0MsUUFBVCxFQUFtQjtBQUNqQixhQUFLQSxRQUFMLENBQWNDLFdBQWQsQ0FBMEJGLE1BQTFCO0FBQ0Q7QUFDRjs7O2tDQVVhQSxNLEVBS1g7QUFDRCxVQUFJLEtBQUtDLFFBQVQsRUFBbUI7QUFDakIsYUFBS0EsUUFBTCxDQUFjRSxhQUFkLENBQTRCSCxNQUE1QjtBQUNEO0FBQ0Y7OztpQ0FRWUEsTSxFQUlWO0FBQ0QsVUFBSSxLQUFLQyxRQUFULEVBQW1CO0FBQ2pCLGFBQUtBLFFBQUwsQ0FBY0csWUFBZCxDQUEy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LGFBQWEsRUFBYkEsYUFBRDtBQUFnQkQsY0FBQUEsT0FBTyxFQUFQQTtBQUFoQixhQUFELENBQXRCO0FBQ0QsV0FSRCxNQVFPO0FBQ0xWLFlBQUFBLHNCQUFzQixDQUFDZCxJQUFELENBQXRCO0FBQ0Q7QUFDRjtBQUNGLE9BbEJEO0FBbUJEOzs7NkJBK0JRO0FBQ1AsYUFDRSxvQkFBQyxlQUFELDZCQUNNLEtBQUt6QixLQURYO0FBRUUsUUFBQSxVQUFVLEVBQUUsS0FBS3dCLFdBRm5CO0FBR0UsUUFBQSxPQUFPLEVBQUUsS0FBS25CLFFBSGhCO0FBSUUsUUFBQSxZQUFZLEVBQUUsS0FBS08sYUFKckI7QUFLRSxRQUFBLFlBQVksRUFBRSxLQUFLSSxhQUxyQjtBQU1FLFFBQUEsR0FBRyxFQUFFLEtBQUtiLFdBTlo7QUFPRSxRQUFBLDhCQUE4QixFQUFFLEtBQUtEO0FBUHZDLFNBREY7QUFXRDs7O0VBOVMyQnRCLEtBQUssQ0FBQ3dFLGE7O0FBQTlCL0QsUSxDQUNHSixZLEdBQTZCQSxZO0FBZ1R0QyxJQUFNNEMsTUFBTSxHQUFHOUMsVUFBVSxDQUFDc0UsTUFBWCxDQUFrQjtBQUMvQnZCLEVBQUFBLEdBQUcsRUFBRTtBQUFDd0IsSUFBQUEsYUFBYSxFQUFFO0FBQWhCO0FBRDBCLENBQWxCLENBQWY7QUFJQUMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCbkUsUUFBakIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmbG93XG4gKiBAZm9ybWF0XG4gKi9cbid1c2Ugc3RyaWN0JztcblxuY29uc3QgUGxhdGZvcm0gPSByZXF1aXJlKCdQbGF0Zm9ybScpO1xuY29uc3QgZGVlcERpZmZlciA9IHJlcXVpcmUoJ2RlZXBEaWZmZXInKTtcbmNvbnN0IFJlYWN0ID0gcmVxdWlyZSgnUmVhY3QnKTtcbmNvbnN0IFZpZXcgPSByZXF1aXJlKCdWaWV3Jyk7XG5jb25zdCBWaXJ0dWFsaXplZExpc3QgPSByZXF1aXJlKCdWaXJ0dWFsaXplZExpc3QnKTtcbmNvbnN0IFN0eWxlU2hlZXQgPSByZXF1aXJlKCdTdHlsZVNoZWV0Jyk7XG5cbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ludmFyaWFudCcpO1xuXG5pbXBvcnQgdHlwZSB7Vmlld1N0eWxlUHJvcH0gZnJvbSAnU3R5bGVTaGVldCc7XG5pbXBvcnQgdHlwZSB7XG4gIFZpZXdhYmlsaXR5Q29uZmlnLFxuICBWaWV3VG9rZW4sXG4gIFZpZXdhYmlsaXR5Q29uZmlnQ2FsbGJhY2tQYWlyLFxufSBmcm9tICdWaWV3YWJpbGl0eUhlbHBlcic7XG5pbXBvcnQgdHlwZSB7UHJvcHMgYXMgVmlydHVhbGl6ZWRMaXN0UHJvcHN9IGZyb20gJ1ZpcnR1YWxpemVkTGlzdCc7XG5cbmV4cG9ydCB0eXBlIFNlcGFyYXRvcnNPYmogPSB7XG4gIGhpZ2hsaWdodDogKCkgPT4gdm9pZCxcbiAgdW5oaWdobGlnaHQ6ICgpID0+IHZvaWQsXG4gIHVwZGF0ZVByb3BzOiAoc2VsZWN0OiAnbGVhZGluZycgfCAndHJhaWxpbmcnLCBuZXdQcm9wczogT2JqZWN0KSA9PiB2b2lkLFxufTtcblxudHlwZSBSZXF1aXJlZFByb3BzPEl0ZW1UPiA9IHtcbiAgLyoqXG4gICAqIFRha2VzIGFuIGl0ZW0gZnJvbSBgZGF0YWAgYW5kIHJlbmRlcnMgaXQgaW50byB0aGUgbGlzdC4gRXhhbXBsZSB1c2FnZTpcbiAgICpcbiAgICogICAgIDxGbGF0TGlzdFxuICAgKiAgICAgICBJdGVtU2VwYXJhdG9yQ29tcG9uZW50PXtQbGF0Zm9ybS5PUyAhPT0gJ2FuZHJvaWQnICYmICh7aGlnaGxpZ2h0ZWR9KSA9PiAoXG4gICAqICAgICAgICAgPFZpZXcgc3R5bGU9e1tzdHlsZS5zZXBhcmF0b3IsIGhpZ2hsaWdodGVkICYmIHttYXJnaW5MZWZ0OiAwfV19IC8+XG4gICAqICAgICAgICl9XG4gICAqICAgICAgIGRhdGE9e1t7dGl0bGU6ICdUaXRsZSBUZXh0Jywga2V5OiAnaXRlbTEnfV19XG4gICAqICAgICAgIHJlbmRlckl0ZW09eyh7aXRlbSwgc2VwYXJhdG9yc30pID0+IChcbiAgICogICAgICAgICA8VG91Y2hhYmxlSGlnaGxpZ2h0XG4gICAqICAgICAgICAgICBvblByZXNzPXsoKSA9PiB0aGlzLl9vblByZXNzKGl0ZW0pfVxuICAgKiAgICAgICAgICAgb25TaG93VW5kZXJsYXk9e3NlcGFyYXRvcnMuaGlnaGxpZ2h0fVxuICAgKiAgICAgICAgICAgb25IaWRlVW5kZXJsYXk9e3NlcGFyYXRvcnMudW5oaWdobGlnaHR9PlxuICAgKiAgICAgICAgICAgPFZpZXcgc3R5bGU9e3tiYWNrZ3JvdW5kQ29sb3I6ICd3aGl0ZSd9fT5cbiAgICogICAgICAgICAgICAgPFRleHQ+e2l0ZW0udGl0bGV9PC9UZXh0PlxuICAgKiAgICAgICAgICAgPC9WaWV3PlxuICAgKiAgICAgICAgIDwvVG91Y2hhYmxlSGlnaGxpZ2h0PlxuICAgKiAgICAgICApfVxuICAgKiAgICAgLz5cbiAgICpcbiAgICogUHJvdmlkZXMgYWRkaXRpb25hbCBtZXRhZGF0YSBsaWtlIGBpbmRleGAgaWYgeW91IG5lZWQgaXQsIGFzIHdlbGwgYXMgYSBtb3JlIGdlbmVyaWNcbiAgICogYHNlcGFyYXRvcnMudXBkYXRlUHJvcHNgIGZ1bmN0aW9uIHdoaWNoIGxldCdzIHlvdSBzZXQgd2hhdGV2ZXIgcHJvcHMgeW91IHdhbnQgdG8gY2hhbmdlIHRoZVxuICAgKiByZW5kZXJpbmcgb2YgZWl0aGVyIHRoZSBsZWFkaW5nIHNlcGFyYXRvciBvciB0cmFpbGluZyBzZXBhcmF0b3IgaW4gY2FzZSB0aGUgbW9yZSBjb21tb25cbiAgICogYGhpZ2hsaWdodGAgYW5kIGB1bmhpZ2hsaWdodGAgKHdoaWNoIHNldCB0aGUgYGhpZ2hsaWdodGVkOiBib29sZWFuYCBwcm9wKSBhcmUgaW5zdWZmaWNpZW50IGZvclxuICAgKiB5b3VyIHVzZS1jYXNlLlxuICAgKi9cbiAgcmVuZGVySXRlbTogKGluZm86IHtcbiAgICBpdGVtOiBJdGVtVCxcbiAgICBpbmRleDogbnVtYmVyLFxuICAgIHNlcGFyYXRvcnM6IFNlcGFyYXRvcnNPYmosXG4gIH0pID0+ID9SZWFjdC5FbGVtZW50PGFueT4sXG4gIC8qKlxuICAgKiBGb3Igc2ltcGxpY2l0eSwgZGF0YSBpcyBqdXN0IGEgcGxhaW4gYXJyYXkuIElmIHlvdSB3YW50IHRvIHVzZSBzb21ldGhpbmcgZWxzZSwgbGlrZSBhblxuICAgKiBpbW11dGFibGUgbGlzdCwgdXNlIHRoZSB1bmRlcmx5aW5nIGBWaXJ0dWFsaXplZExpc3RgIGRpcmVjdGx5LlxuICAgKi9cbiAgZGF0YTogPyRSZWFkT25seUFycmF5PEl0ZW1UPixcbn07XG50eXBlIE9wdGlvbmFsUHJvcHM8SXRlbVQ+ID0ge1xuICAvKipcbiAgICogUmVuZGVyZWQgaW4gYmV0d2VlbiBlYWNoIGl0ZW0sIGJ1dCBub3QgYXQgdGhlIHRvcCBvciBib3R0b20uIEJ5IGRlZmF1bHQsIGBoaWdobGlnaHRlZGAgYW5kXG4gICAqIGBsZWFkaW5nSXRlbWAgcHJvcHMgYXJlIHByb3ZpZGVkLiBgcmVuZGVySXRlbWAgcHJvdmlkZXMgYHNlcGFyYXRvcnMuaGlnaGxpZ2h0YC9gdW5oaWdobGlnaHRgXG4gICAqIHdoaWNoIHdpbGwgdXBkYXRlIHRoZSBgaGlnaGxpZ2h0ZWRgIHByb3AsIGJ1dCB5b3UgY2FuIGFsc28gYWRkIGN1c3RvbSBwcm9wcyB3aXRoXG4gICAqIGBzZXBhcmF0b3JzLnVwZGF0ZVByb3BzYC5cbiAgICovXG4gIEl0ZW1TZXBhcmF0b3JDb21wb25lbnQ/OiA/UmVhY3QuQ29tcG9uZW50VHlwZTxhbnk+LFxuICAvKipcbiAgICogUmVuZGVyZWQgd2hlbiB0aGUgbGlzdCBpcyBlbXB0eS4gQ2FuIGJlIGEgUmVhY3QgQ29tcG9uZW50IENsYXNzLCBhIHJlbmRlciBmdW5jdGlvbiwgb3JcbiAgICogYSByZW5kZXJlZCBlbGVtZW50LlxuICAgKi9cbiAgTGlzdEVtcHR5Q29tcG9uZW50PzogPyhSZWFjdC5Db21wb25lbnRUeXBlPGFueT4gfCBSZWFjdC5FbGVtZW50PGFueT4pLFxuICAvKipcbiAgICogUmVuZGVyZWQgYXQgdGhlIGJvdHRvbSBvZiBhbGwgdGhlIGl0ZW1zLiBDYW4gYmUgYSBSZWFjdCBDb21wb25lbnQgQ2xhc3MsIGEgcmVuZGVyIGZ1bmN0aW9uLCBvclxuICAgKiBhIHJlbmRlcmVkIGVsZW1lbnQuXG4gICAqL1xuICBMaXN0Rm9vdGVyQ29tcG9uZW50PzogPyhSZWFjdC5Db21wb25lbnRUeXBlPGFueT4gfCBSZWFjdC5FbGVtZW50PGFueT4pLFxuICAvKipcbiAgICogU3R5bGluZyBmb3IgaW50ZXJuYWwgVmlldyBmb3IgTGlzdEZvb3RlckNvbXBvbmVudFxuICAgKi9cbiAgTGlzdEZvb3RlckNvbXBvbmVudFN0eWxlPzogVmlld1N0eWxlUHJvcCxcbiAgLyoqXG4gICAqIFJlbmRlcmVkIGF0IHRoZSB0b3Agb2YgYWxsIHRoZSBpdGVtcy4gQ2FuIGJlIGEgUmVhY3QgQ29tcG9uZW50IENsYXNzLCBhIHJlbmRlciBmdW5jdGlvbiwgb3JcbiAgICogYSByZW5kZXJlZCBlbGVtZW50LlxuICAgKi9cbiAgTGlzdEhlYWRlckNvbXBvbmVudD86ID8oUmVhY3QuQ29tcG9uZW50VHlwZTxhbnk+IHwgUmVhY3QuRWxlbWVudDxhbnk+KSxcbiAgLyoqXG4gICAqIFN0eWxpbmcgZm9yIGludGVybmFsIFZpZXcgZm9yIExpc3RIZWFkZXJDb21wb25lbnRcbiAgICovXG4gIExpc3RIZWFkZXJDb21wb25lbnRTdHlsZT86IFZpZXdTdHlsZVByb3AsXG4gIC8qKlxuICAgKiBPcHRpb25hbCBjdXN0b20gc3R5bGUgZm9yIG11bHRpLWl0ZW0gcm93cyBnZW5lcmF0ZWQgd2hlbiBudW1Db2x1bW5zID4gMS5cbiAgICovXG4gIGNvbHVtbldyYXBwZXJTdHlsZT86IFZpZXdTdHlsZVByb3AsXG4gIC8qKlxuICAgKiBBIG1hcmtlciBwcm9wZXJ0eSBmb3IgdGVsbGluZyB0aGUgbGlzdCB0byByZS1yZW5kZXIgKHNpbmNlIGl0IGltcGxlbWVudHMgYFB1cmVDb21wb25lbnRgKS4gSWZcbiAgICogYW55IG9mIHlvdXIgYHJlbmRlckl0ZW1gLCBIZWFkZXIsIEZvb3RlciwgZXRjLiBmdW5jdGlvbnMgZGVwZW5kIG9uIGFueXRoaW5nIG91dHNpZGUgb2YgdGhlXG4gICAqIGBkYXRhYCBwcm9wLCBzdGljayBpdCBoZXJlIGFuZCB0cmVhdCBpdCBpbW11dGFibHkuXG4gICAqL1xuICBleHRyYURhdGE/OiBhbnksXG4gIC8qKlxuICAgKiBgZ2V0SXRlbUxheW91dGAgaXMgYW4gb3B0aW9uYWwgb3B0aW1pemF0aW9ucyB0aGF0IGxldCB1cyBza2lwIG1lYXN1cmVtZW50IG9mIGR5bmFtaWMgY29udGVudCBpZlxuICAgKiB5b3Uga25vdyB0aGUgaGVpZ2h0IG9mIGl0ZW1zIGEgcHJpb3JpLiBgZ2V0SXRlbUxheW91dGAgaXMgdGhlIG1vc3QgZWZmaWNpZW50LCBhbmQgaXMgZWFzeSB0b1xuICAgKiB1c2UgaWYgeW91IGhhdmUgZml4ZWQgaGVpZ2h0IGl0ZW1zLCBmb3IgZXhhbXBsZTpcbiAgICpcbiAgICogICAgIGdldEl0ZW1MYXlvdXQ9eyhkYXRhLCBpbmRleCkgPT4gKFxuICAgKiAgICAgICB7bGVuZ3RoOiBJVEVNX0hFSUdIVCwgb2Zmc2V0OiBJVEVNX0hFSUdIVCAqIGluZGV4LCBpbmRleH1cbiAgICogICAgICl9XG4gICAqXG4gICAqIEFkZGluZyBgZ2V0SXRlbUxheW91dGAgY2FuIGJlIGEgZ3JlYXQgcGVyZm9ybWFuY2UgYm9vc3QgZm9yIGxpc3RzIG9mIHNldmVyYWwgaHVuZHJlZCBpdGVtcy5cbiAgICogUmVtZW1iZXIgdG8gaW5jbHVkZSBzZXBhcmF0b3IgbGVuZ3RoIChoZWlnaHQgb3Igd2lkdGgpIGluIHlvdXIgb2Zmc2V0IGNhbGN1bGF0aW9uIGlmIHlvdVxuICAgKiBzcGVjaWZ5IGBJdGVtU2VwYXJhdG9yQ29tcG9uZW50YC5cbiAgICovXG4gIGdldEl0ZW1MYXlvdXQ/OiAoXG4gICAgZGF0YTogP0FycmF5PEl0ZW1UPixcbiAgICBpbmRleDogbnVtYmVyLFxuICApID0+IHtsZW5ndGg6IG51bWJlciwgb2Zmc2V0OiBudW1iZXIsIGluZGV4OiBudW1iZXJ9LFxuICAvKipcbiAgICogSWYgdHJ1ZSwgcmVuZGVycyBpdGVtcyBuZXh0IHRvIGVhY2ggb3RoZXIgaG9yaXpvbnRhbGx5IGluc3RlYWQgb2Ygc3RhY2tlZCB2ZXJ0aWNhbGx5LlxuICAgKi9cbiAgaG9yaXpvbnRhbD86ID9ib29sZWFuLFxuICAvKipcbiAgICogSG93IG1hbnkgaXRlbXMgdG8gcmVuZGVyIGluIHRoZSBpbml0aWFsIGJhdGNoLiBUaGlzIHNob3VsZCBiZSBlbm91Z2ggdG8gZmlsbCB0aGUgc2NyZWVuIGJ1dCBub3RcbiAgICogbXVjaCBtb3JlLiBOb3RlIHRoZXNlIGl0ZW1zIHdpbGwgbmV2ZXIgYmUgdW5tb3VudGVkIGFzIHBhcnQgb2YgdGhlIHdpbmRvd2VkIHJlbmRlcmluZyBpbiBvcmRlclxuICAgKiB0byBpbXByb3ZlIHBlcmNlaXZlZCBwZXJmb3JtYW5jZSBvZiBzY3JvbGwtdG8tdG9wIGFjdGlvbnMuXG4gICAqL1xuICBpbml0aWFsTnVtVG9SZW5kZXI6IG51bWJlcixcbiAgLyoqXG4gICAqIEluc3RlYWQgb2Ygc3RhcnRpbmcgYXQgdGhlIHRvcCB3aXRoIHRoZSBmaXJzdCBpdGVtLCBzdGFydCBhdCBgaW5pdGlhbFNjcm9sbEluZGV4YC4gVGhpc1xuICAgKiBkaXNhYmxlcyB0aGUgXCJzY3JvbGwgdG8gdG9wXCIgb3B0aW1pemF0aW9uIHRoYXQga2VlcHMgdGhlIGZpcnN0IGBpbml0aWFsTnVtVG9SZW5kZXJgIGl0ZW1zXG4gICAqIGFsd2F5cyByZW5kZXJlZCBhbmQgaW1tZWRpYXRlbHkgcmVuZGVycyB0aGUgaXRlbXMgc3RhcnRpbmcgYXQgdGhpcyBpbml0aWFsIGluZGV4LiBSZXF1aXJlc1xuICAgKiBgZ2V0SXRlbUxheW91dGAgdG8gYmUgaW1wbGVtZW50ZWQuXG4gICAqL1xuICBpbml0aWFsU2Nyb2xsSW5kZXg/OiA/bnVtYmVyLFxuICAvKipcbiAgICogUmV2ZXJzZXMgdGhlIGRpcmVjdGlvbiBvZiBzY3JvbGwuIFVzZXMgc2NhbGUgdHJhbnNmb3JtcyBvZiAtMS5cbiAgICovXG4gIGludmVydGVkPzogP2Jvb2xlYW4sXG4gIC8qKlxuICAgKiBVc2VkIHRvIGV4dHJhY3QgYSB1bmlxdWUga2V5IGZvciBhIGdpdmVuIGl0ZW0gYXQgdGhlIHNwZWNpZmllZCBpbmRleC4gS2V5IGlzIHVzZWQgZm9yIGNhY2hpbmdcbiAgICogYW5kIGFzIHRoZSByZWFjdCBrZXkgdG8gdHJhY2sgaXRlbSByZS1vcmRlcmluZy4gVGhlIGRlZmF1bHQgZXh0cmFjdG9yIGNoZWNrcyBgaXRlbS5rZXlgLCB0aGVuXG4gICAqIGZhbGxzIGJhY2sgdG8gdXNpbmcgdGhlIGluZGV4LCBsaWtlIFJlYWN0IGRvZXMuXG4gICAqL1xuICBrZXlFeHRyYWN0b3I6IChpdGVtOiBJdGVtVCwgaW5kZXg6IG51bWJlcikgPT4gc3RyaW5nLFxuICAvKipcbiAgICogTXVsdGlwbGUgY29sdW1ucyBjYW4gb25seSBiZSByZW5kZXJlZCB3aXRoIGBob3Jpem9udGFsPXtmYWxzZX1gIGFuZCB3aWxsIHppZy16YWcgbGlrZSBhXG4gICAqIGBmbGV4V3JhcGAgbGF5b3V0LiBJdGVtcyBzaG91bGQgYWxsIGJlIHRoZSBzYW1lIGhlaWdodCAtIG1hc29ucnkgbGF5b3V0cyBhcmUgbm90IHN1cHBvcnRlZC5cbiAgICovXG4gIG51bUNvbHVtbnM6IG51bWJlcixcbiAgLyoqXG4gICAqIENhbGxlZCBvbmNlIHdoZW4gdGhlIHNjcm9sbCBwb3NpdGlvbiBnZXRzIHdpdGhpbiBgb25FbmRSZWFjaGVkVGhyZXNob2xkYCBvZiB0aGUgcmVuZGVyZWRcbiAgICogY29udGVudC5cbiAgICovXG4gIG9uRW5kUmVhY2hlZD86ID8oaW5mbzoge2Rpc3RhbmNlRnJvbUVuZDogbnVtYmVyfSkgPT4gdm9pZCxcbiAgLyoqXG4gICAqIEhvdyBmYXIgZnJvbSB0aGUgZW5kIChpbiB1bml0cyBvZiB2aXNpYmxlIGxlbmd0aCBvZiB0aGUgbGlzdCkgdGhlIGJvdHRvbSBlZGdlIG9mIHRoZVxuICAgKiBsaXN0IG11c3QgYmUgZnJvbSB0aGUgZW5kIG9mIHRoZSBjb250ZW50IHRvIHRyaWdnZXIgdGhlIGBvbkVuZFJlYWNoZWRgIGNhbGxiYWNrLlxuICAgKiBUaHVzIGEgdmFsdWUgb2YgMC41IHdpbGwgdHJpZ2dlciBgb25FbmRSZWFjaGVkYCB3aGVuIHRoZSBlbmQgb2YgdGhlIGNvbnRlbnQgaXNcbiAgICogd2l0aGluIGhhbGYgdGhlIHZpc2libGUgbGVuZ3RoIG9mIHRoZSBsaXN0LlxuICAgKi9cbiAgb25FbmRSZWFjaGVkVGhyZXNob2xkPzogP251bWJlcixcbiAgLyoqXG4gICAqIElmIHByb3ZpZGVkLCBhIHN0YW5kYXJkIFJlZnJlc2hDb250cm9sIHdpbGwgYmUgYWRkZWQgZm9yIFwiUHVsbCB0byBSZWZyZXNoXCIgZnVuY3Rpb25hbGl0eS4gTWFrZVxuICAgKiBzdXJlIHRvIGFsc28gc2V0IHRoZSBgcmVmcmVzaGluZ2AgcHJvcCBjb3JyZWN0bHkuXG4gICAqL1xuICBvblJlZnJlc2g/OiA/KCkgPT4gdm9pZCxcbiAgLyoqXG4gICAqIENhbGxlZCB3aGVuIHRoZSB2aWV3YWJpbGl0eSBvZiByb3dzIGNoYW5nZXMsIGFzIGRlZmluZWQgYnkgdGhlIGB2aWV3YWJpbGl0eUNvbmZpZ2AgcHJvcC5cbiAgICovXG4gIG9uVmlld2FibGVJdGVtc0NoYW5nZWQ/OiA/KGluZm86IHtcbiAgICB2aWV3YWJsZUl0ZW1zOiBBcnJheTxWaWV3VG9rZW4+LFxuICAgIGNoYW5nZWQ6IEFycmF5PFZpZXdUb2tlbj4sXG4gIH0pID0+IHZvaWQsXG4gIC8qKlxuICAgKiBTZXQgdGhpcyB3aGVuIG9mZnNldCBpcyBuZWVkZWQgZm9yIHRoZSBsb2FkaW5nIGluZGljYXRvciB0byBzaG93IGNvcnJlY3RseS5cbiAgICogQHBsYXRmb3JtIGFuZHJvaWRcbiAgICovXG4gIHByb2dyZXNzVmlld09mZnNldD86IG51bWJlcixcbiAgLyoqXG4gICAqIFRoZSBsZWdhY3kgaW1wbGVtZW50YXRpb24gaXMgbm8gbG9uZ2VyIHN1cHBvcnRlZC5cbiAgICovXG4gIGxlZ2FjeUltcGxlbWVudGF0aW9uPzogZW1wdHksXG4gIC8qKlxuICAgKiBTZXQgdGhpcyB0cnVlIHdoaWxlIHdhaXRpbmcgZm9yIG5ldyBkYXRhIGZyb20gYSByZWZyZXNoLlxuICAgKi9cbiAgcmVmcmVzaGluZz86ID9ib29sZWFuLFxuICAvKipcbiAgICogTm90ZTogbWF5IGhhdmUgYnVncyAobWlzc2luZyBjb250ZW50KSBpbiBzb21lIGNpcmN1bXN0YW5jZXMgLSB1c2UgYXQgeW91ciBvd24gcmlzay5cbiAgICpcbiAgICogVGhpcyBtYXkgaW1wcm92ZSBzY3JvbGwgcGVyZm9ybWFuY2UgZm9yIGxhcmdlIGxpc3RzLlxuICAgKi9cbiAgcmVtb3ZlQ2xpcHBlZFN1YnZpZXdzPzogYm9vbGVhbixcbiAgLyoqXG4gICAqIFNlZSBgVmlld2FiaWxpdHlIZWxwZXJgIGZvciBmbG93IHR5cGUgYW5kIGZ1cnRoZXIgZG9jdW1lbnRhdGlvbi5cbiAgICovXG4gIHZpZXdhYmlsaXR5Q29uZmlnPzogVmlld2FiaWxpdHlDb25maWcsXG4gIC8qKlxuICAgKiBMaXN0IG9mIFZpZXdhYmlsaXR5Q29uZmlnL29uVmlld2FibGVJdGVtc0NoYW5nZWQgcGFpcnMuIEEgc3BlY2lmaWMgb25WaWV3YWJsZUl0ZW1zQ2hhbmdlZFxuICAgKiB3aWxsIGJlIGNhbGxlZCB3aGVuIGl0cyBjb3JyZXNwb25kaW5nIFZpZXdhYmlsaXR5Q29uZmlnJ3MgY29uZGl0aW9ucyBhcmUgbWV0LlxuICAgKi9cbiAgdmlld2FiaWxpdHlDb25maWdDYWxsYmFja1BhaXJzPzogQXJyYXk8Vmlld2FiaWxpdHlDb25maWdDYWxsYmFja1BhaXI+LFxufTtcbmV4cG9ydCB0eXBlIFByb3BzPEl0ZW1UPiA9IFJlcXVpcmVkUHJvcHM8SXRlbVQ+ICZcbiAgT3B0aW9uYWxQcm9wczxJdGVtVD4gJlxuICBWaXJ0dWFsaXplZExpc3RQcm9wcztcblxuY29uc3QgZGVmYXVsdFByb3BzID0ge1xuICAuLi5WaXJ0dWFsaXplZExpc3QuZGVmYXVsdFByb3BzLFxuICBudW1Db2x1bW5zOiAxLFxuICAvKipcbiAgICogRW5hYmxpbmcgdGhpcyBwcm9wIG9uIEFuZHJvaWQgZ3JlYXRseSBpbXByb3ZlcyBzY3JvbGxpbmcgcGVyZm9ybWFuY2Ugd2l0aCBubyBrbm93biBpc3N1ZXMuXG4gICAqIFRoZSBhbHRlcm5hdGl2ZSBpcyB0aGF0IHNjcm9sbGluZyBvbiBBbmRyb2lkIGlzIHVudXNhYmx5IGJhZC4gRW5hYmxpbmcgaXQgb24gaU9TIGhhcyBhIGZld1xuICAgKiBrbm93biBpc3N1ZXMuXG4gICAqL1xuICByZW1vdmVDbGlwcGVkU3Vidmlld3M6IFBsYXRmb3JtLk9TID09PSAnYW5kcm9pZCcsXG59O1xuZXhwb3J0IHR5cGUgRGVmYXVsdFByb3BzID0gdHlwZW9mIGRlZmF1bHRQcm9wcztcblxuLyoqXG4gKiBBIHBlcmZvcm1hbnQgaW50ZXJmYWNlIGZvciByZW5kZXJpbmcgc2ltcGxlLCBmbGF0IGxpc3RzLCBzdXBwb3J0aW5nIHRoZSBtb3N0IGhhbmR5IGZlYXR1cmVzOlxuICpcbiAqICAtIEZ1bGx5IGNyb3NzLXBsYXRmb3JtLlxuICogIC0gT3B0aW9uYWwgaG9yaXpvbnRhbCBtb2RlLlxuICogIC0gQ29uZmlndXJhYmxlIHZpZXdhYmlsaXR5IGNhbGxiYWNrcy5cbiAqICAtIEhlYWRlciBzdXBwb3J0LlxuICogIC0gRm9vdGVyIHN1cHBvcnQuXG4gKiAgLSBTZXBhcmF0b3Igc3VwcG9ydC5cbiAqICAtIFB1bGwgdG8gUmVmcmVzaC5cbiAqICAtIFNjcm9sbCBsb2FkaW5nLlxuICogIC0gU2Nyb2xsVG9JbmRleCBzdXBwb3J0LlxuICpcbiAqIElmIHlvdSBuZWVkIHNlY3Rpb24gc3VwcG9ydCwgdXNlIFtgPFNlY3Rpb25MaXN0PmBdKGRvY3Mvc2VjdGlvbmxpc3QuaHRtbCkuXG4gKlxuICogTWluaW1hbCBFeGFtcGxlOlxuICpcbiAqICAgICA8RmxhdExpc3RcbiAqICAgICAgIGRhdGE9e1t7a2V5OiAnYSd9LCB7a2V5OiAnYid9XX1cbiAqICAgICAgIHJlbmRlckl0ZW09eyh7aXRlbX0pID0+IDxUZXh0PntpdGVtLmtleX08L1RleHQ+fVxuICogICAgIC8+XG4gKlxuICogTW9yZSBjb21wbGV4LCBtdWx0aS1zZWxlY3QgZXhhbXBsZSBkZW1vbnN0cmF0aW5nIGBQdXJlQ29tcG9uZW50YCB1c2FnZSBmb3IgcGVyZiBvcHRpbWl6YXRpb24gYW5kIGF2b2lkaW5nIGJ1Z3MuXG4gKlxuICogLSBCeSBiaW5kaW5nIHRoZSBgb25QcmVzc0l0ZW1gIGhhbmRsZXIsIHRoZSBwcm9wcyB3aWxsIHJlbWFpbiBgPT09YCBhbmQgYFB1cmVDb21wb25lbnRgIHdpbGxcbiAqICAgcHJldmVudCB3YXN0ZWZ1bCByZS1yZW5kZXJzIHVubGVzcyB0aGUgYWN0dWFsIGBpZGAsIGBzZWxlY3RlZGAsIG9yIGB0aXRsZWAgcHJvcHMgY2hhbmdlLCBldmVuXG4gKiAgIGlmIHRoZSBjb21wb25lbnRzIHJlbmRlcmVkIGluIGBNeUxpc3RJdGVtYCBkaWQgbm90IGhhdmUgc3VjaCBvcHRpbWl6YXRpb25zLlxuICogLSBCeSBwYXNzaW5nIGBleHRyYURhdGE9e3RoaXMuc3RhdGV9YCB0byBgRmxhdExpc3RgIHdlIG1ha2Ugc3VyZSBgRmxhdExpc3RgIGl0c2VsZiB3aWxsIHJlLXJlbmRlclxuICogICB3aGVuIHRoZSBgc3RhdGUuc2VsZWN0ZWRgIGNoYW5nZXMuIFdpdGhvdXQgc2V0dGluZyB0aGlzIHByb3AsIGBGbGF0TGlzdGAgd291bGQgbm90IGtub3cgaXRcbiAqICAgbmVlZHMgdG8gcmUtcmVuZGVyIGFueSBpdGVtcyBiZWNhdXNlIGl0IGlzIGFsc28gYSBgUHVyZUNvbXBvbmVudGAgYW5kIHRoZSBwcm9wIGNvbXBhcmlzb24gd2lsbFxuICogICBub3Qgc2hvdyBhbnkgY2hhbmdlcy5cbiAqIC0gYGtleUV4dHJhY3RvcmAgdGVsbHMgdGhlIGxpc3QgdG8gdXNlIHRoZSBgaWRgcyBmb3IgdGhlIHJlYWN0IGtleXMgaW5zdGVhZCBvZiB0aGUgZGVmYXVsdCBga2V5YCBwcm9wZXJ0eS5cbiAqXG4gKlxuICogICAgIGNsYXNzIE15TGlzdEl0ZW0gZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50IHtcbiAqICAgICAgIF9vblByZXNzID0gKCkgPT4ge1xuICogICAgICAgICB0aGlzLnByb3BzLm9uUHJlc3NJdGVtKHRoaXMucHJvcHMuaWQpO1xuICogICAgICAgfTtcbiAqXG4gKiAgICAgICByZW5kZXIoKSB7XG4gKiAgICAgICAgIGNvbnN0IHRleHRDb2xvciA9IHRoaXMucHJvcHMuc2VsZWN0ZWQgPyBcInJlZFwiIDogXCJibGFja1wiO1xuICogICAgICAgICByZXR1cm4gKFxuICogICAgICAgICAgIDxUb3VjaGFibGVPcGFjaXR5IG9uUHJlc3M9e3RoaXMuX29uUHJlc3N9PlxuICogICAgICAgICAgICAgPFZpZXc+XG4gKiAgICAgICAgICAgICAgIDxUZXh0IHN0eWxlPXt7IGNvbG9yOiB0ZXh0Q29sb3IgfX0+XG4gKiAgICAgICAgICAgICAgICAge3RoaXMucHJvcHMudGl0bGV9XG4gKiAgICAgICAgICAgICAgIDwvVGV4dD5cbiAqICAgICAgICAgICAgIDwvVmlldz5cbiAqICAgICAgICAgICA8L1RvdWNoYWJsZU9wYWNpdHk+XG4gKiAgICAgICAgICk7XG4gKiAgICAgICB9XG4gKiAgICAgfVxuICpcbiAqICAgICBjbGFzcyBNdWx0aVNlbGVjdExpc3QgZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50IHtcbiAqICAgICAgIHN0YXRlID0ge3NlbGVjdGVkOiAobmV3IE1hcCgpOiBNYXA8c3RyaW5nLCBib29sZWFuPil9O1xuICpcbiAqICAgICAgIF9rZXlFeHRyYWN0b3IgPSAoaXRlbSwgaW5kZXgpID0+IGl0ZW0uaWQ7XG4gKlxuICogICAgICAgX29uUHJlc3NJdGVtID0gKGlkOiBzdHJpbmcpID0+IHtcbiAqICAgICAgICAgLy8gdXBkYXRlciBmdW5jdGlvbnMgYXJlIHByZWZlcnJlZCBmb3IgdHJhbnNhY3Rpb25hbCB1cGRhdGVzXG4gKiAgICAgICAgIHRoaXMuc2V0U3RhdGUoKHN0YXRlKSA9PiB7XG4gKiAgICAgICAgICAgLy8gY29weSB0aGUgbWFwIHJhdGhlciB0aGFuIG1vZGlmeWluZyBzdGF0ZS5cbiAqICAgICAgICAgICBjb25zdCBzZWxlY3RlZCA9IG5ldyBNYXAoc3RhdGUuc2VsZWN0ZWQpO1xuICogICAgICAgICAgIHNlbGVjdGVkLnNldChpZCwgIXNlbGVjdGVkLmdldChpZCkpOyAvLyB0b2dnbGVcbiAqICAgICAgICAgICByZXR1cm4ge3NlbGVjdGVkfTtcbiAqICAgICAgICAgfSk7XG4gKiAgICAgICB9O1xuICpcbiAqICAgICAgIF9yZW5kZXJJdGVtID0gKHtpdGVtfSkgPT4gKFxuICogICAgICAgICA8TXlMaXN0SXRlbVxuICogICAgICAgICAgIGlkPXtpdGVtLmlkfVxuICogICAgICAgICAgIG9uUHJlc3NJdGVtPXt0aGlzLl9vblByZXNzSXRlbX1cbiAqICAgICAgICAgICBzZWxlY3RlZD17ISF0aGlzLnN0YXRlLnNlbGVjdGVkLmdldChpdGVtLmlkKX1cbiAqICAgICAgICAgICB0aXRsZT17aXRlbS50aXRsZX1cbiAqICAgICAgICAgLz5cbiAqICAgICAgICk7XG4gKlxuICogICAgICAgcmVuZGVyKCkge1xuICogICAgICAgICByZXR1cm4gKFxuICogICAgICAgICAgIDxGbGF0TGlzdFxuICogICAgICAgICAgICAgZGF0YT17dGhpcy5wcm9wcy5kYXRhfVxuICogICAgICAgICAgICAgZXh0cmFEYXRhPXt0aGlzLnN0YXRlfVxuICogICAgICAgICAgICAga2V5RXh0cmFjdG9yPXt0aGlzLl9rZXlFeHRyYWN0b3J9XG4gKiAgICAgICAgICAgICByZW5kZXJJdGVtPXt0aGlzLl9yZW5kZXJJdGVtfVxuICogICAgICAgICAgIC8+XG4gKiAgICAgICAgICk7XG4gKiAgICAgICB9XG4gKiAgICAgfVxuICpcbiAqIFRoaXMgaXMgYSBjb252ZW5pZW5jZSB3cmFwcGVyIGFyb3VuZCBbYDxWaXJ0dWFsaXplZExpc3Q+YF0oZG9jcy92aXJ0dWFsaXplZGxpc3QuaHRtbCksXG4gKiBhbmQgdGh1cyBpbmhlcml0cyBpdHMgcHJvcHMgKGFzIHdlbGwgYXMgdGhvc2Ugb2YgYFNjcm9sbFZpZXdgKSB0aGF0IGFyZW4ndCBleHBsaWNpdGx5IGxpc3RlZFxuICogaGVyZSwgYWxvbmcgd2l0aCB0aGUgZm9sbG93aW5nIGNhdmVhdHM6XG4gKlxuICogLSBJbnRlcm5hbCBzdGF0ZSBpcyBub3QgcHJlc2VydmVkIHdoZW4gY29udGVudCBzY3JvbGxzIG91dCBvZiB0aGUgcmVuZGVyIHdpbmRvdy4gTWFrZSBzdXJlIGFsbFxuICogICB5b3VyIGRhdGEgaXMgY2FwdHVyZWQgaW4gdGhlIGl0ZW0gZGF0YSBvciBleHRlcm5hbCBzdG9yZXMgbGlrZSBGbHV4LCBSZWR1eCwgb3IgUmVsYXkuXG4gKiAtIFRoaXMgaXMgYSBgUHVyZUNvbXBvbmVudGAgd2hpY2ggbWVhbnMgdGhhdCBpdCB3aWxsIG5vdCByZS1yZW5kZXIgaWYgYHByb3BzYCByZW1haW4gc2hhbGxvdy1cbiAqICAgZXF1YWwuIE1ha2Ugc3VyZSB0aGF0IGV2ZXJ5dGhpbmcgeW91ciBgcmVuZGVySXRlbWAgZnVuY3Rpb24gZGVwZW5kcyBvbiBpcyBwYXNzZWQgYXMgYSBwcm9wXG4gKiAgIChlLmcuIGBleHRyYURhdGFgKSB0aGF0IGlzIG5vdCBgPT09YCBhZnRlciB1cGRhdGVzLCBvdGhlcndpc2UgeW91ciBVSSBtYXkgbm90IHVwZGF0ZSBvblxuICogICBjaGFuZ2VzLiBUaGlzIGluY2x1ZGVzIHRoZSBgZGF0YWAgcHJvcCBhbmQgcGFyZW50IGNvbXBvbmVudCBzdGF0ZS5cbiAqIC0gSW4gb3JkZXIgdG8gY29uc3RyYWluIG1lbW9yeSBhbmQgZW5hYmxlIHNtb290aCBzY3JvbGxpbmcsIGNvbnRlbnQgaXMgcmVuZGVyZWQgYXN5bmNocm9ub3VzbHlcbiAqICAgb2Zmc2NyZWVuLiBUaGlzIG1lYW5zIGl0J3MgcG9zc2libGUgdG8gc2Nyb2xsIGZhc3RlciB0aGFuIHRoZSBmaWxsIHJhdGUgYW5kcyBtb21lbnRhcmlseSBzZWVcbiAqICAgYmxhbmsgY29udGVudC4gVGhpcyBpcyBhIHRyYWRlb2ZmIHRoYXQgY2FuIGJlIGFkanVzdGVkIHRvIHN1aXQgdGhlIG5lZWRzIG9mIGVhY2ggYXBwbGljYXRpb24sXG4gKiAgIGFuZCB3ZSBhcmUgd29ya2luZyBvbiBpbXByb3ZpbmcgaXQgYmVoaW5kIHRoZSBzY2VuZXMuXG4gKiAtIEJ5IGRlZmF1bHQsIHRoZSBsaXN0IGxvb2tzIGZvciBhIGBrZXlgIHByb3Agb24gZWFjaCBpdGVtIGFuZCB1c2VzIHRoYXQgZm9yIHRoZSBSZWFjdCBrZXkuXG4gKiAgIEFsdGVybmF0aXZlbHksIHlvdSBjYW4gcHJvdmlkZSBhIGN1c3RvbSBga2V5RXh0cmFjdG9yYCBwcm9wLlxuICpcbiAqIEFsc28gaW5oZXJpdHMgW1Njcm9sbFZpZXcgUHJvcHNdKGRvY3Mvc2Nyb2xsdmlldy5odG1sI3Byb3BzKSwgdW5sZXNzIGl0IGlzIG5lc3RlZCBpbiBhbm90aGVyIEZsYXRMaXN0IG9mIHNhbWUgb3JpZW50YXRpb24uXG4gKi9cbmNsYXNzIEZsYXRMaXN0PEl0ZW1UPiBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQ8UHJvcHM8SXRlbVQ+LCB2b2lkPiB7XG4gIHN0YXRpYyBkZWZhdWx0UHJvcHM6IERlZmF1bHRQcm9wcyA9IGRlZmF1bHRQcm9wcztcbiAgcHJvcHM6IFByb3BzPEl0ZW1UPjtcbiAgLyoqXG4gICAqIFNjcm9sbHMgdG8gdGhlIGVuZCBvZiB0aGUgY29udGVudC4gTWF5IGJlIGphbmt5IHdpdGhvdXQgYGdldEl0ZW1MYXlvdXRgIHByb3AuXG4gICAqL1xuICBzY3JvbGxUb0VuZChwYXJhbXM/OiA/e2FuaW1hdGVkPzogP2Jvb2xlYW59KSB7XG4gICAgaWYgKHRoaXMuX2xpc3RSZWYpIHtcbiAgICAgIHRoaXMuX2xpc3RSZWYuc2Nyb2xsVG9FbmQocGFyYW1zKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2Nyb2xscyB0byB0aGUgaXRlbSBhdCB0aGUgc3BlY2lmaWVkIGluZGV4IHN1Y2ggdGhhdCBpdCBpcyBwb3NpdGlvbmVkIGluIHRoZSB2aWV3YWJsZSBhcmVhXG4gICAqIHN1Y2ggdGhhdCBgdmlld1Bvc2l0aW9uYCAwIHBsYWNlcyBpdCBhdCB0aGUgdG9wLCAxIGF0IHRoZSBib3R0b20sIGFuZCAwLjUgY2VudGVyZWQgaW4gdGhlXG4gICAqIG1pZGRsZS4gYHZpZXdPZmZzZXRgIGlzIGEgZml4ZWQgbnVtYmVyIG9mIHBpeGVscyB0byBvZmZzZXQgdGhlIGZpbmFsIHRhcmdldCBwb3NpdGlvbi5cbiAgICpcbiAgICogTm90ZTogY2Fubm90IHNjcm9sbCB0byBsb2NhdGlvbnMgb3V0c2lkZSB0aGUgcmVuZGVyIHdpbmRvdyB3aXRob3V0IHNwZWNpZnlpbmcgdGhlXG4gICAqIGBnZXRJdGVtTGF5b3V0YCBwcm9wLlxuICAgKi9cbiAgc2Nyb2xsVG9JbmRleChwYXJhbXM6IHtcbiAgICBhbmltYXRlZD86ID9ib29sZWFuLFxuICAgIGluZGV4OiBudW1iZXIsXG4gICAgdmlld09mZnNldD86IG51bWJlcixcbiAgICB2aWV3UG9zaXRpb24/OiBudW1iZXIsXG4gIH0pIHtcbiAgICBpZiAodGhpcy5fbGlzdFJlZikge1xuICAgICAgdGhpcy5fbGlzdFJlZi5zY3JvbGxUb0luZGV4KHBhcmFtcyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlcXVpcmVzIGxpbmVhciBzY2FuIHRocm91Z2ggZGF0YSAtIHVzZSBgc2Nyb2xsVG9JbmRleGAgaW5zdGVhZCBpZiBwb3NzaWJsZS5cbiAgICpcbiAgICogTm90ZTogY2Fubm90IHNjcm9sbCB0byBsb2NhdGlvbnMgb3V0c2lkZSB0aGUgcmVuZGVyIHdpbmRvdyB3aXRob3V0IHNwZWNpZnlpbmcgdGhlXG4gICAqIGBnZXRJdGVtTGF5b3V0YCBwcm9wLlxuICAgKi9cbiAgc2Nyb2xsVG9JdGVtKHBhcmFtczoge1xuICAgIGFuaW1hdGVkPzogP2Jvb2xlYW4sXG4gICAgaXRlbTogSXRlbVQsXG4gICAgdmlld1Bvc2l0aW9uPzogbnVtYmVyLFxuICB9KSB7XG4gICAgaWYgKHRoaXMuX2xpc3RSZWYpIHtcbiAgICAgIHRoaXMuX2xpc3RSZWYuc2Nyb2xsVG9JdGVtKHBhcmFtcyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNjcm9sbCB0byBhIHNwZWNpZmljIGNvbnRlbnQgcGl4ZWwgb2Zmc2V0IGluIHRoZSBsaXN0LlxuICAgKlxuICAgKiBDaGVjayBvdXQgW3Njcm9sbFRvT2Zmc2V0XShkb2NzL3ZpcnR1YWxpemVkbGlzdC5odG1sI3Njcm9sbHRvb2Zmc2V0KSBvZiBWaXJ0dWFsaXplZExpc3RcbiAgICovXG4gIHNjcm9sbFRvT2Zmc2V0KHBhcmFtczoge2FuaW1hdGVkPzogP2Jvb2xlYW4sIG9mZnNldDogbnVtYmVyfSkge1xuICAgIGlmICh0aGlzLl9saXN0UmVmKSB7XG4gICAgICB0aGlzLl9saXN0UmVmLnNjcm9sbFRvT2Zmc2V0KHBhcmFtcyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFRlbGxzIHRoZSBsaXN0IGFuIGludGVyYWN0aW9uIGhhcyBvY2N1cnJlZCwgd2hpY2ggc2hvdWxkIHRyaWdnZXIgdmlld2FiaWxpdHkgY2FsY3VsYXRpb25zLCBlLmcuXG4gICAqIGlmIGB3YWl0Rm9ySW50ZXJhY3Rpb25zYCBpcyB0cnVlIGFuZCB0aGUgdXNlciBoYXMgbm90IHNjcm9sbGVkLiBUaGlzIGlzIHR5cGljYWxseSBjYWxsZWQgYnlcbiAgICogdGFwcyBvbiBpdGVtcyBvciBieSBuYXZpZ2F0aW9uIGFjdGlvbnMuXG4gICAqL1xuICByZWNvcmRJbnRlcmFjdGlvbigpIHtcbiAgICBpZiAodGhpcy5fbGlzdFJlZikge1xuICAgICAgdGhpcy5fbGlzdFJlZi5yZWNvcmRJbnRlcmFjdGlvbigpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEaXNwbGF5cyB0aGUgc2Nyb2xsIGluZGljYXRvcnMgbW9tZW50YXJpbHkuXG4gICAqXG4gICAqIEBwbGF0Zm9ybSBpb3NcbiAgICovXG4gIGZsYXNoU2Nyb2xsSW5kaWNhdG9ycygpIHtcbiAgICBpZiAodGhpcy5fbGlzdFJlZikge1xuICAgICAgdGhpcy5fbGlzdFJlZi5mbGFzaFNjcm9sbEluZGljYXRvcnMoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUHJvdmlkZXMgYSBoYW5kbGUgdG8gdGhlIHVuZGVybHlpbmcgc2Nyb2xsIHJlc3BvbmRlci5cbiAgICovXG4gIGdldFNjcm9sbFJlc3BvbmRlcigpIHtcbiAgICBpZiAodGhpcy5fbGlzdFJlZikge1xuICAgICAgcmV0dXJuIHRoaXMuX2xpc3RSZWYuZ2V0U2Nyb2xsUmVzcG9uZGVyKCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0U2Nyb2xsYWJsZU5vZGUoKSB7XG4gICAgaWYgKHRoaXMuX2xpc3RSZWYpIHtcbiAgICAgIHJldHVybiB0aGlzLl9saXN0UmVmLmdldFNjcm9sbGFibGVOb2RlKCk7XG4gICAgfVxuICB9XG5cbiAgc2V0TmF0aXZlUHJvcHMocHJvcHM6IHtbc3RyaW5nXTogbWl4ZWR9KSB7XG4gICAgaWYgKHRoaXMuX2xpc3RSZWYpIHtcbiAgICAgIHRoaXMuX2xpc3RSZWYuc2V0TmF0aXZlUHJvcHMocHJvcHMpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByb3BzOiBQcm9wczxJdGVtVD4pIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgdGhpcy5fY2hlY2tQcm9wcyh0aGlzLnByb3BzKTtcbiAgICBpZiAodGhpcy5wcm9wcy52aWV3YWJpbGl0eUNvbmZpZ0NhbGxiYWNrUGFpcnMpIHtcbiAgICAgIHRoaXMuX3ZpcnR1YWxpemVkTGlzdFBhaXJzID0gdGhpcy5wcm9wcy52aWV3YWJpbGl0eUNvbmZpZ0NhbGxiYWNrUGFpcnMubWFwKFxuICAgICAgICBwYWlyID0+ICh7XG4gICAgICAgICAgdmlld2FiaWxpdHlDb25maWc6IHBhaXIudmlld2FiaWxpdHlDb25maWcsXG4gICAgICAgICAgb25WaWV3YWJsZUl0ZW1zQ2hhbmdlZDogdGhpcy5fY3JlYXRlT25WaWV3YWJsZUl0ZW1zQ2hhbmdlZChcbiAgICAgICAgICAgIHBhaXIub25WaWV3YWJsZUl0ZW1zQ2hhbmdlZCxcbiAgICAgICAgICApLFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfSBlbHNlIGlmICh0aGlzLnByb3BzLm9uVmlld2FibGVJdGVtc0NoYW5nZWQpIHtcbiAgICAgIC8qICRGbG93Rml4TWUoPj0wLjYzLjAgc2l0ZT1yZWFjdF9uYXRpdmVfZmIpIFRoaXMgY29tbWVudCBzdXBwcmVzc2VzIGFuXG4gICAgICAgKiBlcnJvciBmb3VuZCB3aGVuIEZsb3cgdjAuNjMgd2FzIGRlcGxveWVkLiBUbyBzZWUgdGhlIGVycm9yIGRlbGV0ZSB0aGlzXG4gICAgICAgKiBjb21tZW50IGFuZCBydW4gRmxvdy4gKi9cbiAgICAgIHRoaXMuX3ZpcnR1YWxpemVkTGlzdFBhaXJzLnB1c2goe1xuICAgICAgICB2aWV3YWJpbGl0eUNvbmZpZzogdGhpcy5wcm9wcy52aWV3YWJpbGl0eUNvbmZpZyxcbiAgICAgICAgb25WaWV3YWJsZUl0ZW1zQ2hhbmdlZDogdGhpcy5fY3JlYXRlT25WaWV3YWJsZUl0ZW1zQ2hhbmdlZChcbiAgICAgICAgICB0aGlzLnByb3BzLm9uVmlld2FibGVJdGVtc0NoYW5nZWQsXG4gICAgICAgICksXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzOiBQcm9wczxJdGVtVD4pIHtcbiAgICBpbnZhcmlhbnQoXG4gICAgICBwcmV2UHJvcHMubnVtQ29sdW1ucyA9PT0gdGhpcy5wcm9wcy5udW1Db2x1bW5zLFxuICAgICAgJ0NoYW5naW5nIG51bUNvbHVtbnMgb24gdGhlIGZseSBpcyBub3Qgc3VwcG9ydGVkLiBDaGFuZ2UgdGhlIGtleSBwcm9wIG9uIEZsYXRMaXN0IHdoZW4gJyArXG4gICAgICAgICdjaGFuZ2luZyB0aGUgbnVtYmVyIG9mIGNvbHVtbnMgdG8gZm9yY2UgYSBmcmVzaCByZW5kZXIgb2YgdGhlIGNvbXBvbmVudC4nLFxuICAgICk7XG4gICAgaW52YXJpYW50KFxuICAgICAgcHJldlByb3BzLm9uVmlld2FibGVJdGVtc0NoYW5nZWQgPT09IHRoaXMucHJvcHMub25WaWV3YWJsZUl0ZW1zQ2hhbmdlZCxcbiAgICAgICdDaGFuZ2luZyBvblZpZXdhYmxlSXRlbXNDaGFuZ2VkIG9uIHRoZSBmbHkgaXMgbm90IHN1cHBvcnRlZCcsXG4gICAgKTtcbiAgICBpbnZhcmlhbnQoXG4gICAgICAhZGVlcERpZmZlcihwcmV2UHJvcHMudmlld2FiaWxpdHlDb25maWcsIHRoaXMucHJvcHMudmlld2FiaWxpdHlDb25maWcpLFxuICAgICAgJ0NoYW5naW5nIHZpZXdhYmlsaXR5Q29uZmlnIG9uIHRoZSBmbHkgaXMgbm90IHN1cHBvcnRlZCcsXG4gICAgKTtcbiAgICBpbnZhcmlhbnQoXG4gICAgICBwcmV2UHJvcHMudmlld2FiaWxpdHlDb25maWdDYWxsYmFja1BhaXJzID09PVxuICAgICAgICB0aGlzLnByb3BzLnZpZXdhYmlsaXR5Q29uZmlnQ2FsbGJhY2tQYWlycyxcbiAgICAgICdDaGFuZ2luZyB2aWV3YWJpbGl0eUNvbmZpZ0NhbGxiYWNrUGFpcnMgb24gdGhlIGZseSBpcyBub3Qgc3VwcG9ydGVkJyxcbiAgICApO1xuXG4gICAgdGhpcy5fY2hlY2tQcm9wcyh0aGlzLnByb3BzKTtcbiAgfVxuXG4gIF9saXN0UmVmOiA/UmVhY3QuRWxlbWVudFJlZjx0eXBlb2YgVmlydHVhbGl6ZWRMaXN0PjtcbiAgX3ZpcnR1YWxpemVkTGlzdFBhaXJzOiBBcnJheTxWaWV3YWJpbGl0eUNvbmZpZ0NhbGxiYWNrUGFpcj4gPSBbXTtcblxuICBfY2FwdHVyZVJlZiA9IHJlZiA9PiB7XG4gICAgdGhpcy5fbGlzdFJlZiA9IHJlZjtcbiAgfTtcblxuICBfY2hlY2tQcm9wcyhwcm9wczogUHJvcHM8SXRlbVQ+KSB7XG4gICAgY29uc3Qge1xuICAgICAgZ2V0SXRlbSxcbiAgICAgIGdldEl0ZW1Db3VudCxcbiAgICAgIGhvcml6b250YWwsXG4gICAgICBudW1Db2x1bW5zLFxuICAgICAgY29sdW1uV3JhcHBlclN0eWxlLFxuICAgICAgb25WaWV3YWJsZUl0ZW1zQ2hhbmdlZCxcbiAgICAgIHZpZXdhYmlsaXR5Q29uZmlnQ2FsbGJhY2tQYWlycyxcbiAgICB9ID0gcHJvcHM7XG4gICAgaW52YXJpYW50KFxuICAgICAgIWdldEl0ZW0gJiYgIWdldEl0ZW1Db3VudCxcbiAgICAgICdGbGF0TGlzdCBkb2VzIG5vdCBzdXBwb3J0IGN1c3RvbSBkYXRhIGZvcm1hdHMuJyxcbiAgICApO1xuICAgIGlmIChudW1Db2x1bW5zID4gMSkge1xuICAgICAgaW52YXJpYW50KCFob3Jpem9udGFsLCAnbnVtQ29sdW1ucyBkb2VzIG5vdCBzdXBwb3J0IGhvcml6b250YWwuJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGludmFyaWFudChcbiAgICAgICAgIWNvbHVtbldyYXBwZXJTdHlsZSxcbiAgICAgICAgJ2NvbHVtbldyYXBwZXJTdHlsZSBub3Qgc3VwcG9ydGVkIGZvciBzaW5nbGUgY29sdW1uIGxpc3RzJyxcbiAgICAgICk7XG4gICAgfVxuICAgIGludmFyaWFudChcbiAgICAgICEob25WaWV3YWJsZUl0ZW1zQ2hhbmdlZCAmJiB2aWV3YWJpbGl0eUNvbmZpZ0NhbGxiYWNrUGFpcnMpLFxuICAgICAgJ0ZsYXRMaXN0IGRvZXMgbm90IHN1cHBvcnQgc2V0dGluZyBib3RoIG9uVmlld2FibGVJdGVtc0NoYW5nZWQgYW5kICcgK1xuICAgICAgICAndmlld2FiaWxpdHlDb25maWdDYWxsYmFja1BhaXJzLicsXG4gICAgKTtcbiAgfVxuXG4gIF9nZXRJdGVtID0gKGRhdGE6IEFycmF5PEl0ZW1UPiwgaW5kZXg6IG51bWJlcikgPT4ge1xuICAgIGNvbnN0IHtudW1Db2x1bW5zfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKG51bUNvbHVtbnMgPiAxKSB7XG4gICAgICBjb25zdCByZXQgPSBbXTtcbiAgICAgIGZvciAobGV0IGtrID0gMDsga2sgPCBudW1Db2x1bW5zOyBraysrKSB7XG4gICAgICAgIGNvbnN0IGl0ZW0gPSBkYXRhW2luZGV4ICogbnVtQ29sdW1ucyArIGtrXTtcbiAgICAgICAgaWYgKGl0ZW0gIT0gbnVsbCkge1xuICAgICAgICAgIHJldC5wdXNoKGl0ZW0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcmV0O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZGF0YVtpbmRleF07XG4gICAgfVxuICB9O1xuXG4gIF9nZXRJdGVtQ291bnQgPSAoZGF0YTogP0FycmF5PEl0ZW1UPik6IG51bWJlciA9PiB7XG4gICAgcmV0dXJuIGRhdGEgPyBNYXRoLmNlaWwoZGF0YS5sZW5ndGggLyB0aGlzLnByb3BzLm51bUNvbHVtbnMpIDogMDtcbiAgfTtcblxuICBfa2V5RXh0cmFjdG9yID0gKGl0ZW1zOiBJdGVtVCB8IEFycmF5PEl0ZW1UPiwgaW5kZXg6IG51bWJlcikgPT4ge1xuICAgIGNvbnN0IHtrZXlFeHRyYWN0b3IsIG51bUNvbHVtbnN9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAobnVtQ29sdW1ucyA+IDEpIHtcbiAgICAgIGludmFyaWFudChcbiAgICAgICAgQXJyYXkuaXNBcnJheShpdGVtcyksXG4gICAgICAgICdGbGF0TGlzdDogRW5jb3VudGVyZWQgaW50ZXJuYWwgY29uc2lzdGVuY3kgZXJyb3IsIGV4cGVjdGVkIGVhY2ggaXRlbSB0byBjb25zaXN0IG9mIGFuICcgK1xuICAgICAgICAgICdhcnJheSB3aXRoIDEtJXMgY29sdW1uczsgaW5zdGVhZCwgcmVjZWl2ZWQgYSBzaW5nbGUgaXRlbS4nLFxuICAgICAgICBudW1Db2x1bW5zLFxuICAgICAgKTtcbiAgICAgIHJldHVybiBpdGVtc1xuICAgICAgICAubWFwKChpdCwga2spID0+IGtleUV4dHJhY3RvcihpdCwgaW5kZXggKiBudW1Db2x1bW5zICsga2spKVxuICAgICAgICAuam9pbignOicpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvKiAkRmxvd0ZpeE1lKD49MC42My4wIHNpdGU9cmVhY3RfbmF0aXZlX2ZiKSBUaGlzIGNvbW1lbnQgc3VwcHJlc3NlcyBhblxuICAgICAgICogZXJyb3IgZm91bmQgd2hlbiBGbG93IHYwLjYzIHdhcyBkZXBsb3llZC4gVG8gc2VlIHRoZSBlcnJvciBkZWxldGUgdGhpc1xuICAgICAgICogY29tbWVudCBhbmQgcnVuIEZsb3cuICovXG4gICAgICByZXR1cm4ga2V5RXh0cmFjdG9yKGl0ZW1zLCBpbmRleCk7XG4gICAgfVxuICB9O1xuXG4gIF9wdXNoTXVsdGlDb2x1bW5WaWV3YWJsZShhcnI6IEFycmF5PFZpZXdUb2tlbj4sIHY6IFZpZXdUb2tlbik6IHZvaWQge1xuICAgIGNvbnN0IHtudW1Db2x1bW5zLCBrZXlFeHRyYWN0b3J9ID0gdGhpcy5wcm9wcztcbiAgICB2Lml0ZW0uZm9yRWFjaCgoaXRlbSwgaWkpID0+IHtcbiAgICAgIGludmFyaWFudCh2LmluZGV4ICE9IG51bGwsICdNaXNzaW5nIGluZGV4IScpO1xuICAgICAgY29uc3QgaW5kZXggPSB2LmluZGV4ICogbnVtQ29sdW1ucyArIGlpO1xuICAgICAgYXJyLnB1c2goey4uLnYsIGl0ZW0sIGtleToga2V5RXh0cmFjdG9yKGl0ZW0sIGluZGV4KSwgaW5kZXh9KTtcbiAgICB9KTtcbiAgfVxuXG4gIF9jcmVhdGVPblZpZXdhYmxlSXRlbXNDaGFuZ2VkKFxuICAgIG9uVmlld2FibGVJdGVtc0NoYW5nZWQ6ID8oaW5mbzoge1xuICAgICAgdmlld2FibGVJdGVtczogQXJyYXk8Vmlld1Rva2VuPixcbiAgICAgIGNoYW5nZWQ6IEFycmF5PFZpZXdUb2tlbj4sXG4gICAgfSkgPT4gdm9pZCxcbiAgKSB7XG4gICAgcmV0dXJuIChpbmZvOiB7XG4gICAgICB2aWV3YWJsZUl0ZW1zOiBBcnJheTxWaWV3VG9rZW4+LFxuICAgICAgY2hhbmdlZDogQXJyYXk8Vmlld1Rva2VuPixcbiAgICB9KSA9PiB7XG4gICAgICBjb25zdCB7bnVtQ29sdW1uc30gPSB0aGlzLnByb3BzO1xuICAgICAgaWYgKG9uVmlld2FibGVJdGVtc0NoYW5nZWQpIHtcbiAgICAgICAgaWYgKG51bUNvbHVtbnMgPiAxKSB7XG4gICAgICAgICAgY29uc3QgY2hhbmdlZCA9IFtdO1xuICAgICAgICAgIGNvbnN0IHZpZXdhYmxlSXRlbXMgPSBbXTtcbiAgICAgICAgICBpbmZvLnZpZXdhYmxlSXRlbXMuZm9yRWFjaCh2ID0+XG4gICAgICAgICAgICB0aGlzLl9wdXNoTXVsdGlDb2x1bW5WaWV3YWJsZSh2aWV3YWJsZUl0ZW1zLCB2KSxcbiAgICAgICAgICApO1xuICAgICAgICAgIGluZm8uY2hhbmdlZC5mb3JFYWNoKHYgPT4gdGhpcy5fcHVzaE11bHRpQ29sdW1uVmlld2FibGUoY2hhbmdlZCwgdikpO1xuICAgICAgICAgIG9uVmlld2FibGVJdGVtc0NoYW5nZWQoe3ZpZXdhYmxlSXRlbXMsIGNoYW5nZWR9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBvblZpZXdhYmxlSXRlbXNDaGFuZ2VkKGluZm8pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIF9yZW5kZXJJdGVtID0gKGluZm86IE9iamVjdCkgPT4ge1xuICAgIGNvbnN0IHtyZW5kZXJJdGVtLCBudW1Db2x1bW5zLCBjb2x1bW5XcmFwcGVyU3R5bGV9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAobnVtQ29sdW1ucyA+IDEpIHtcbiAgICAgIGNvbnN0IHtpdGVtLCBpbmRleH0gPSBpbmZvO1xuICAgICAgaW52YXJpYW50KFxuICAgICAgICBBcnJheS5pc0FycmF5KGl0ZW0pLFxuICAgICAgICAnRXhwZWN0ZWQgYXJyYXkgb2YgaXRlbXMgd2l0aCBudW1Db2x1bW5zID4gMScsXG4gICAgICApO1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPFZpZXdcbiAgICAgICAgICBzdHlsZT17U3R5bGVTaGVldC5jb21wb3NlKFxuICAgICAgICAgICAgc3R5bGVzLnJvdyxcbiAgICAgICAgICAgIGNvbHVtbldyYXBwZXJTdHlsZSxcbiAgICAgICAgICApfT5cbiAgICAgICAgICB7aXRlbS5tYXAoKGl0LCBraykgPT4ge1xuICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IHJlbmRlckl0ZW0oe1xuICAgICAgICAgICAgICBpdGVtOiBpdCxcbiAgICAgICAgICAgICAgaW5kZXg6IGluZGV4ICogbnVtQ29sdW1ucyArIGtrLFxuICAgICAgICAgICAgICBzZXBhcmF0b3JzOiBpbmZvLnNlcGFyYXRvcnMsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50ICYmIFJlYWN0LmNsb25lRWxlbWVudChlbGVtZW50LCB7a2V5OiBra30pO1xuICAgICAgICAgIH0pfVxuICAgICAgICA8L1ZpZXc+XG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gcmVuZGVySXRlbShpbmZvKTtcbiAgICB9XG4gIH07XG5cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiAoXG4gICAgICA8VmlydHVhbGl6ZWRMaXN0XG4gICAgICAgIHsuLi50aGlzLnByb3BzfVxuICAgICAgICByZW5kZXJJdGVtPXt0aGlzLl9yZW5kZXJJdGVtfVxuICAgICAgICBnZXRJdGVtPXt0aGlzLl9nZXRJdGVtfVxuICAgICAgICBnZXRJdGVtQ291bnQ9e3RoaXMuX2dldEl0ZW1Db3VudH1cbiAgICAgICAga2V5RXh0cmFjdG9yPXt0aGlzLl9rZXlFeHRyYWN0b3J9XG4gICAgICAgIHJlZj17dGhpcy5fY2FwdHVyZVJlZn1cbiAgICAgICAgdmlld2FiaWxpdHlDb25maWdDYWxsYmFja1BhaXJzPXt0aGlzLl92aXJ0dWFsaXplZExpc3RQYWlyc31cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxufVxuXG5jb25zdCBzdHlsZXMgPSBTdHlsZVNoZWV0LmNyZWF0ZSh7XG4gIHJvdzoge2ZsZXhEaXJlY3Rpb246ICdyb3cnfSxcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEZsYXRMaXN0O1xuIl19